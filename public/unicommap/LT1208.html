<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="index_basinMap.css" />
    <link href="leaflet/Control.MiniMap.min.css" rel="stylesheet" />
    <link href="leaflet/leaflet.marker.highlight.css" rel="stylesheet" />
    <link href="index/css/index.css" rel="stylesheet" />
    <link href="index/fonts/iconfont/iconfont.css" rel="stylesheet" />
    <link href="index/css/animate.min.css" rel="stylesheet" />
    <link href="index/css/num1.css" rel="stylesheet" />
    <link href="css/pretty.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/mapProject.css" />
    <link rel="stylesheet" href="index/css/index.css" />
      <!--leaflet-->

      <script src="leaflet/leaflet.js"></script>
      <link href="leaflet/leaflet.css" rel="stylesheet" />
      <script src="leaflet/leaflet-src.js"></script>
      <script src="leaflet/leaflet-omnivore.min.js"></script>
      <script src="leaflet/leaflet-ant-path.js"></script>
      <!-- <script src="leaflet/leaflet.marker.highlight.js"></script> -->
      <script src="leaflet/Control.MiniMap.min.js"></script>
      <script src="leaflet/Label.js"></script>
      <script src="leaflet/BaseMarkerMethods.js"></script>
      <script src="leaflet/CircleMarker.Label.js"></script>
      <script src="leaflet/Map.Label.js"></script>
      <!-- <script src="index/js/jquery.js"></script> -->
    <script src="index/js/echarts.min.js"></script>
    <script src="jquery-1.10.2.js"></script>
    <link rel="stylesheet" type="text/css" href="jQueryDropdown/jquery.dropdown.min.css">
    <script src="jQueryDropdown/jquery.dropdown.min.js"></script>
   
   <!--   <script src="index/js/javascript.util.js"></script>
    <script src="index/js/jsts.js"></script>
    <script src="index/js/mapconfig.js"></script>
    <script src="index/js/pmapwebapps.js" type="text/javascript"></script>
    <script src="index/js/jsencrypt.js"></script>
    <script src="index/js/md5.min.js"></script> -->

 <style>
    .fullScreen {
    position: absolute;
    bottom: 15px;
    right: 60px;
    width: 40px;
    height: 40px;
    padding: 4px;
    background: rgba(22,91,176,0.9);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    box-sizing: border-box;
    z-index: 1000;
}
        #mapDiv {
            /*必须指定高度*/
            height: 100%;
        }
                select {
            background-color: transparent;
            color: #ffffff;
            border: none;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 20px;
            outline: none;
        }
        .sand-body {
            font-family: PingFang SC;
            font-size: 14px;
            font-style: normal;
            font-weight: normal;
            color: rgba(255, 255, 255, 0.85);
        }
    
        .sand-body .unit {
            margin-left: 13px;
        }
    
        .sand-body select {
            background-color: transparent;
            color: #ffffff;
            border: none;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 20px;
            outline: none;
        }
    
        .sand-body .options {
            position: relative;
        }
        .sand-body .options:after {
            content: "";
            width: 0;
            height: 0;
            border-left: 3px solid transparent;
            border-right: 3px solid transparent;
            border-top: 5px solid #ffffff;
            /*通过定位将图标放在合适的位置*/
            position: absolute;
            right: 0px;
            top: 41%;
            /*给自定义的图标实现点击下来功能*/
            pointer-events: none;
        }
    
        .sand-body p {
            margin: 0px;
        }
    
        .sand-body {
            color: #00C0FF;
        }
        .high-light {
            color: #00C0FF;
            min-width: 150px;
        }
    
        .sand-body hr.gradient {
            margin-top: 0px;
            background: radial-gradient(50% 50% at 50% 50%, rgba(0, 192, 255, 0.5) 57.81%, rgba(10, 244, 251, 0) 100%);
        }
    
        .sand-body .mock-border {
            border: none;
            height: 1px;
            position: absolute;
            left: 0px;
            right: 0px;
        }
    
        .sand-body .title {
            color: #ffffff;
            font-size: 18px;
        }
    
        .sand-body .ellipse,
        .sand-body .ellipse li {
            overflow:scroll;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
    
        /* .sand-body .ellipse:hover, 
        .sand-body .ellipse li:hover {
            overflow: visible;
        } */
        ul {
            list-style-type: none;
            margin: 0px;
            padding: 0px;
        }
    
        .back-contanier {
            position: relative;
            background-color: rgba(5, 38, 75, 0.8);
            color: rgba(255, 255, 255, 0.85);
            border-radius: 4px;
            padding: 8px 16px;
        }
        /** 启用 begin**/
        .refresh-container {
            width: 94px;
            height: 42px;
            padding-top: 9px;
            padding-bottom: 0px;
        }
        .refresh-container img {
            width: 32px;
            height: 32px;
            line-height: 32px;
            cursor: pointer;
        }
        .refresh-container img:first-child {
            margin-right: 16px;
        }
        /** 启用 end**/
        .container-with-padding {
            padding: 8px 16px;
        }
    
        .primary-color {
            color: rgba(255, 255, 255, 0.85);
        }
    
        /** 导航begin **/
        .nav-container {
            width: 100%;
            height: 76px;
            background: url(./icons/header.png) no-repeat;
            background-size: cover;
            display: flex;
            padding: 0 26px;
            align-items: center;
        }
    
        .nav-container .header-left {
            width: 33%;
            display: flex;
            position: relative;
        }
    
        .nav-container .header-left .yunnan-logo {
            width: calc(50% - 10px);
        }
    
        .nav-container .yunnan-logo {
            font-size: 20px;
        }
    
        .nav-container .yuan-logo {
            font-size: 16px;
            margin-left: 10%;
        }
    
        .nav-container .yunnan-logo,
        .nav-container .yuan-logo {
            height: 26px;
            margin-right: 10px;
            position: relative;
            width: 50%;
        }
    
        .nav-container .yunnan-logo::before,
        .nav-container .yuan-logo::before {
            content: '';
            width: 33px;
            height: 27px;
            display: inline-block;
            position: relative;
            top: 5px;
            background: url(./icons/yunnanLogo.png) no-repeat;
            background-size: cover;
        }
    
        .nav-container .yuan-logo::before {
            background: url(./icons/yuan.png) no-repeat;
            top: 8px;
        }
    
        .nav-container .header-left .split {
            width: 1px;
            height: 16px;
            display: inline-block;
            background: rgba(0, 192, 255, 0.65);
            position: absolute;
            left: 46%;
            top: 13px;
        }
    
        .nav-container .header-title {
            font-family: PingFang SC;
            font-style: normal;
            font-weight: 600;
            font-size: 30px;
            line-height: 52px;
            /* width: 384px; */
            width: 33%;
            background-image: -webkit-linear-gradient(bottom, #22BAED, #22BAED, #D6EBFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: ABSOLUTE;
            left: 50%;
            margin-left: -192px;
        }
    
        .nav-container .header-right {
            display: flex;
            flex-wrap: nowrap;
            position: absolute;
            left: 69%;
            bottom: 0px;
        }
    
        .nav-container .header-right li {
            width: 140px;
            height: 55px;
            line-height: 55px;
            text-align: center;
            color: rgba(255, 255, 255, 0.65);
        }
    
        .nav-container .header-right  {
            color: #fff;
            font-family: PingFang SC;
            font-size: 16px;
            /* background: linear-gradient(180deg, rgba(0, 148, 255, 0.4) 0%, rgba(0, 192, 255, 0) 123.81%); */
        }
        .active{
            cursor:pointer;
        }
        .active:hover{
            color: #fff;
            font-family: PingFang SC;
            background: linear-gradient(180deg, rgba(0, 148, 255, 0.4) 0%, rgba(0, 192, 255, 0) 123.81%);

        }
        /** 导航end **/
        /** 角 begin **/
        .angle {
            position: absolute;
            width: 15px;
            height: 15px;
        }
    
        .angle-left-top {
            top: -2px;
            left: -2px;
            border-left: 4px solid #00C0FF;
            border-top: 4px solid #00C0FF;
        }
    
        .angle-right-top {
            top: -2px;
            right: -2px;
            border-right: 4px solid #00C0FF;
            border-top: 4px solid #00C0FF;
        }
    
        .angle-left-bottom {
            bottom: -2px;
            left: -2px;
            border-bottom: 4px solid #00C0FF;
            border-left: 4px solid #00C0FF;
        }
    
        .angle-right-bottom {
            bottom: -2px;
            right: -2px;
            border-right: 4px solid #00C0FF;
            border-bottom: 4px solid #00C0FF;
        }
    
        /** 角 end **/
    
        .nav li {
            background: rgba(0, 192, 255, 0.2);
            border: 1px solid #00C0FF;
            box-sizing: border-box;
            border-radius: 4px;
            height: 36px;
            line-height: 36px;
            width: 100%;
            margin-bottom: 16px;
            cursor: pointer;
            padding: 0 10px;
            color: rgba(254, 255, 255, 0.85);
        }
    
        .nav li.active {
            border-color: #00C0FF;
            color: #ffffff;
            background: rgba(0, 192, 255, 0.65);;
        }
    
        .nav li img {
            margin-right: 9px;
        }
    
        /* .left-nav-container {
            width: 192px;
            height: 234px;
            padding: 16px;
        } */
    
        /** 左侧导航 begin **/
        .left-nav-container {
            width: 308px;
            padding: 16px;
        }
    
        .left-nav-title {
            width: 180px;
            height: 24px;
            font-weight: 500;
            font-size: 16px;
            color: #fff;
            position: relative;
            padding-left: 16px;
            background: linear-gradient(89.95deg, rgba(0, 192, 255, 0.55) -72.95%, rgba(196, 196, 196, 0) 102.45%);
        }
    
        .left-nav-title::before {
            content: '';
            display: inline-block;
            position: absolute;
            left: 0px;
            width: 4px;
            height: 24px;
            background: rgba(0, 192, 255, 0.85);
        }
    
        .left-nav-header>div {
            margin-top: 16px;
            display: flex;
        }
    
        .left-nav-header span {
            color: #ffffff;
            display: block;
            width: 250px;
        }
    
        .left-nav-body {
            background: rgba(0, 192, 255, 0.2);
            border: 1px dashed rgba(0, 192, 255, 0.65);
            box-sizing: border-box;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding-top: 25px;
            margin-top: 16px;
        }
    
        .left-nav-body li {
            width: calc(100% / 3 - 10px);
            height: 50px;
            text-align: center;
            padding: 0 5px;
            align-items: center;
            margin-bottom: 30px;
            align-content: flex-start;
            vertical-align: middle;
        }
    
        .left-nav-body li b {
            font-size: 16px;
            color: rgba(0, 255, 194, 0.8);
        }
    
        .left-nav-body li div {
            color: #fff;
            font-size: 12px;
        }
    
        .more-body {
            margin-top: 24px;
        }
    
        .more-body .left-nav-body {
            background: rgba(37, 91, 218, 0.2);
            border: 1px dashed rgba(109, 159, 255, 0.65);
        }
    
        .more-body .left-nav-body li b {
            color: #82ACFF;
        }
    
        .left-nav {
            padding-bottom: 0px;
        }
    
        .left-nav li {
            font-size: 16px;
            line-height: 30px;
            height: 32px;
        }
    
        .turn-on {
            height: 58px;
            line-height: 56px;
        }
    
        .turn-on img {
            margin-top: 16px;
            margin-right: 22px;
            cursor: pointer;
        }
    
        .turn-on img:first-child {
            margin-left: 16px;
        }
    
        /** 左侧导航 end **/
    
        /** 右侧头部导航 begin **/
        .right-head-nav {
            width: 394px;
            display: flex;
            padding: 7px 0px;
        }
    
        .right-head-nav img {
            position: relative;
            top: 2px;
            margin-left: 8px;
        }
    
        .right-head-nav .projects select {
            width: 165px;
            cursor: pointer;
        }
    
        .right-head-nav .water-line {
            position: relative;
            padding: 0 8px;
            cursor: pointer;
        }
    
        .right-head-nav .water-line select {
            width: 95px;
        }
    
        .right-head-nav .water-line::before,
        .right-head-nav .water-line::after {
            content: '';
            display: block;
            width: 1px;
            height: 16px;
            background: rgba(0, 192, 255, 0.4);
            position: absolute;
            top: 2px
        }
    
        .right-head-nav .water-line::before {
            left: 8px;
        }
    
        .right-head-nav .water-line::after {
            right: 0px;
        }
    
        .right-head-nav .full-screen {
            width: 60px;
            cursor: pointer;
        }
    
        /** 右侧头部导航 end **/
    
        /** 右侧导航 begin **/
        .right-nav-container {
           /*  width: 343px;
            height: 380px; */
            display: flex;
            padding: 0px;
            line-height: 34px;
            color: rgba(254, 255, 255, 0.85);
            background: rgba(5, 38, 75, 0.6);
        }
    
        .right-nav-container li {
            border-color: transparent;
            padding-right: 5px;
        }
    
        .right-nav-container li:hover {
            border-color: #00C0FF;
            color: #ffffff;
            background: rgba(5, 38, 75, 0.8);
        }
    
        .right-nav-container .left,
        .right-nav-container .right {
            padding: 16px;
        }
    
        .right-nav-container .left {
            max-height: 393px;
            overflow:auto;
            width: 174px;
            border-right: 1px solid rgba(0, 192, 255, 0.2);
            ;
        }
    
        .right-nav-container .right embed {
            position: relative;
            top: 3px;
            margin-right: 7px;
        }
    
        /** 右侧导航 end **/
    
        /** 经纬度 begin **/
        .lbs-container {
            width: 190px;
            height: 20px;
            line-height: 20px;
        }
    
        .lbs-container .lat {
            margin-left: 16px;
        }
    
        /** 经纬度 end **/
    
        /** 左侧统计信息栏 beigin **/
        .facility-info-container {
            width: 266px;
            padding-left: 8px;
            padding-right: 8px;
        }
    
        .facility-info-container .title {
            font-weight: 500;
            margin-bottom: 3px;
        }
        .facility-info-container hr {
            background: rgba(0, 192, 255, 0.2);
            margin: 0px;
        }
    
        .facility-info-container p {
            padding-top: 4px;
        }
    
        /** 左侧统计信息栏 end **/
    
        /** 专属设施弹窗 beigin **/
        .facility-modal-container {
            width: 432px;
            padding: 16px 22px;
            border: 1px solid #00C0FF;
        }
        .facility-modal-container .mock-border {
            background-color: rgba(0, 192, 255, 0.2);
            top: 40px;
        }
        .facility-modal-container>div {
            /* //display: flex; */
            margin-bottom: 16px;
        }
    
        .facility-modal-container>div:last-child {
            margin-bottom: 0px;
        }
    
        .facility-modal-container>div label {
            width: 150px;
            min-width: 150px;
            text-align: left;
            margin-right: 5px;
        }
    
        /** 专属设施弹窗 end **/
    
        /** 安置点人信息 end **/
        .arrange-person-container {
            width: 436px;
            height: 690px;
            padding-left: 32px;
            padding-right: 32px;
        }
    
        .arrange-person-container .basic-info {
            display: flex;
            margin-bottom: 24px;
        }
    
        .arrange-person-container img {
            width: 130px;
            height: 200px;
            margin-right: 16px;
        }
    
        .arrange-person-container .basic-info-txt>div {
            margin-bottom: 16px;
        }
    
        .arrange-person-container .basic-info-txt>div:last-child {
            margin-bottom: 0px;
        }
    
        .arrange-person-container hr {
            background: rgba(0, 192, 255, 0.2);
            margin: 0px;
        }
    
        .arrange-person-container .carousel {
            padding-top: 17px;
        }
    
        .arrange-person-container .carousel li {
            display: inline-block;
            border-bottom: 2px solid transparent;
            padding: 2px 5px;
        }
    
        .arrange-person-container .carousel li.active {
            border-color: #00C0FF;
            color: #ffffff;
        }
    
        .arrange-person-container .carousel-content {
            margin-top: 40px;
        }
    
        .arrange-person-container .carousel-content ul {
            display: flex;
        }
    
        .arrange-person-container .carousel-content li {
            width: 432px;
        }
    
        .arrange-person-container .carousel-content img {
            width: 100%;
            height: 252px;
        }
    
        /** 安置点人信息 end **/
    
        /** 村落信息栏 beigin **/
        .town-container {
            width: 300px;
            color: rgba(255, 255, 255, 0.9);

        }
    
        .town-container .aim-body {
            display: flex;
        }
    
        .town-container .aim {
            width: calc(100% - 70px);
        }
    
        .town-container .aim>div {
            position: relative;
        }
    
        .town-container .aim label {
            margin-right: 5px;
        }
    
        .town-container .aim .split {
            content: '';
            display: inline-block;
            width: 1px;
            height: 11px;
            left: 190px;
            top: 9px;
            position: absolute;
            background: #FFFFFF;
            opacity: 0.2;
        }
    
        .town-container .count {
            display: inline-block;
            width: 40px;
            top: 5px;
            position: relative;
            text-align: right;
        }
    
        .town-container .warpper {
            margin-bottom: 16px;
        }
    
        .town-container .unit {
            margin-right: 20px;
        }
    
        /** 村落信息栏 end **/
    
        /** 大坝弹窗 begin **/
        .dam-container {
            width: 420px;
            height: 568px;
            padding: 10px 40px;
        }
    
        .dam-container .basic-info {
            text-indent: 25px;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 16px;
        }
    
        .dam-container .title {
            padding: 16px 0px;
        }
    
       
        .camera{
            position: relative;
            bottom: 50px;
            right:10px;
                float:right;
                margin: 0px;
                padding-top: 10px;
        }
         /** 大坝弹窗 end **/
    
    
    </style>

</head>

<body>
    <div id="mapDiv">
    </div>
            <!-- 下方的图例 -->
            <div class="main-legend">
              <div class=" legend-item">
                  <div class="legend-item-icon legend-plan" id="btn_nijian">
                      <img class="img" src="img/nijian.png" alt="" v-else>
                  </div>
                  <div class="legend-item-val">
                      拟建
                  </div>
              </div>
              <div class=" legend-item">
                  <div class="legend-item-icon legend-doing" id="btn_zaijian">
                      <img class="img" src="img/zaijian.png" alt="" v-else>
                  </div>
                  <div class="legend-item-val">
                      在建
                  </div>
              </div>
              <div class=" legend-item">
                  <div class="legend-item-icon legend-already"id="btn_yijian">
                      <img class="img" src="img/yijian.png" alt="" v-else>
                  </div>
                  <div class="legend-item-val">
                      已建
                  </div>
              </div>
          </div>
              <!-- 村落信息栏 开始 -->
    <div class="back-contanier town-container facility-modal-container" id="pop" style="position: absolute;top:150px;display: none;z-index: 999;">
      <div class="title" >中路乡咱利村腊母底小组</div>
      <hr class="mock-border" />
      <div class="warpper" id="mapCont">
          <label class="high-light">土地编号：</label>
          <span>28530562</span>
      </div>
  </div>


          <div class="dropdown-mul-2" style="position:absolute;top: 15px;left:80px;width:150px;z-index: 999;">
            <select style="display:none" name="" id="mul-2" multiple placeholder="请选择">
            <option value=0 selected>卫星影像</option>
            <option value=1 selected>行政区划</option>
            <option value=2 selected>项目图标</option>
          </select>
          </div>

    <div class="fullScreen" ><img src="img/icon-switch.png" style="height: 100%;width: 100%;"></div>
    <div class="tab" style="width: 196px; height:36px;position: absolute;top:30px;left: 40%;z-index: 999;" ><img src="img/tab_sk.png" style="height: 100%;width: 100%;"></div>
    <!--脚本必须放在尾部-->
    <script>
        var _TiandituSLLabelPath = "http://t{s}.tianditu.gov.cn/cva_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cva&tileMatrixSet=c&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk=b7abd507700e4f349a8c0118ccab43ac";
        var _TiandituYXLabelPath = "http://t{s}.tianditu.gov.cn/cia_c/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=c&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=b7abd507700e4f349a8c0118ccab43ac";
        var _TiandituYXPath = "http://t{s}.tianditu.gov.cn/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk=b7abd507700e4f349a8c0118ccab43ac";
        var projects = null;
        //var map = L.map('mapDiv').setView([32.6116, 103.5571], 9);
        var layer_project = new L.LayerGroup();
        var layer_hf = new L.LayerGroup();
        var flag = false;
        var initCenter = [25.070801, 101.623535];

        var path,path_map="";
        map  = new L.map("mapDiv", {
            minZoom: 1,
            maxZoom: 18,
            center: initCenter,
            zoom: 6,
            zoomControl: true,
            attributionControl: false,
            crs:L.CRS.EPSG4326,
            editable: true,
            doubleClickZoom:false
        });
        var zoomstart = 0;
        var layer_dom =null;
        var layer_xzqh = null;
        var popup = L.popup();
        $(document).ready(function () {
        layer_dom = new L.LayerGroup().addTo(map);
        layer_cmxz = new L.LayerGroup().addTo(map);
        // path = "http://192.168.10.230:6810";
        //  path_map = "http://192.168.10.230:7010";
        path = "http://117.26.22.125/gisapi";
         path_map = "http://117.26.22.125/gis";
         if(location.origin!="http://59.216.201.83"){
        L.tileLayer(_TiandituYXPath, { subdomains: [1, 2, 3], minZoom: 5, maxZoom: 18, storagetype: 0 }).addTo(map);
        L.tileLayer(_TiandituYXLabelPath, { subdomains: [1, 2, 3], minZoom: 5, maxZoom: 18, storagetype: 0 }).addTo(map);
        }else{
        // layer_dom.addLayer(L.tileLayer(path_map+'/sj_raster/v6/wmts/tile/10000201?ak=mf72ff9295c740ec0f37e61433e8a3ad8d&service=WMTS&request=GetTile&version=1.0.0&layer=&style=&tilematrixSet=GoogleCRS84Quad&transparent=1&width=256&height=256&opacity=1&srs=EPSG:4326&tilematrix={z}&tilerow={y}&tilecol={x}', {
        //     attribution: '&copy; <a href="http://osm.org/copyright"></a> contributors'
        // }));
        // layer_dom.addLayer(L.tileLayer('http://192.168.10.231:7010/sj_raster/v6/wmts/tile/1002001?ak=mf72ff9295c740ec0f37e61433e8a3ad8d&service=WMTS&request=GetTile&version=1.0.0&layer=&style=&tilematrixSet=GoogleMapsCompatible&transparent=1&width=256&height=256&opacity=1&srs=EPSG:4490&tilematrix={z}&tilerow={y}&tilecol={x}', {
        //    attribution: '&copy; <a href="http://osm.org/copyright"></a> contributors'
        // }));
        layer_dom.addLayer(L.tileLayer('http://117.26.22.125/gisx/sj_raster/v6/wmts/tile/1002001?ak=mf72ff9295c740ec0f37e61433e8a3ad8d&service=WMTS&request=GetTile&version=1.0.0&layer=&style=&tilematrixSet=GoogleMapsCompatible&transparent=1&width=256&height=256&opacity=1&srs=EPSG:4490&tilematrix={z}&tilerow={y}&tilecol={x}', {
           attribution: '&copy; <a href="http://osm.org/copyright"></a> contributors'
        }));
        initXZQH();
        }
        zoomToXzqh(getUrlParam("xzqh"));
        initSql();
        layer_project.addTo(map);
        layer_hf.addTo(map);
        $('.dropdown-mul-2').dropdown({
            limitCount: 5,
            searchable: false,
            choice: function() {
                var layer_arr = [layer_dom,layer_xzqh,layer_project];
               var arr= $("#mul-2").val();
               if(arr==null)arr=[];
               for(var i=0;i<layer_arr.length;i++){
                   if(arr.indexOf(i+"")==-1)
                   layer_arr[i].eachLayer(function(item){
                       try{item.setStyle({opacity:0,fillOpacity:0});}catch(e){}
                       try{item.setOpacity(0);}catch(e){}
                
            });
                else
                layer_arr[i].eachLayer(function(item){
                    try{item.setStyle({opacity:1,fillOpacity:0});}catch(e){}
                       try{item.setOpacity(1);}catch(e){}
            });
               }
            }
            });
        map.on('click', onMapClick);
        // map.on("zoomend", function (e) {//为marker绑定点击事件
        //  if(zoomstart==0)
        //  zoomstart = map.getZoom();
        //  else{
        //    var zoom = map.getZoom();
        //    initflag_where();
        //   if (zoomstart >= 8&&zoom<8) {
        //     layer_project.clearLayers();
        //     for(var i=0;i<arr_jiandou.length;i++){
        //     //map.remove(  arr_jiandou[i]);
        //     arr_jiandou[i].hide();
        // }
        // arr_jiandou=[];
        //     layer_cmxz.clearLayers();

        //     initProject(); 
        //       }if(zoomstart <= 8&&zoom>8)
        //     {
        //       layer_project.clearLayers();
        //       initProjectALL1();      
        //       }
        //       zoomstart = map.getZoom();
        //  }
        //   });
        $(".tab").click(function(){
            if(flag_Layer){
                $(".tab img").attr("src","img/tab_hf.png");
                layer_project.clearLayers();
                $(".main-legend").hide();
                //layer_hf = new L.LayerGroup();
            }else{
                $(".tab img").attr("src","img/tab_sk.png");
                layer_hf.clearLayers();
                //layer_project = new L.LayerGroup();
                $(".main-legend").show();
            }
            flag_Layer=!flag_Layer;
            if(flag_Layer)initProjectALL1();else initHFLayer();
        });
        });
        function onMapClick(e) {
           $("#pop").hide();
        }
        $(".fullScreen").click(function(){
                if(!flag){
                        $("#fullScreen").attr("title","点击退出全屏");
                        enterFullScreen();
                        flag = true;
                    }else{
                        $("#fullScreen").attr("title","点击全屏浏览");
                        exitFullScreen();
                        flag = false;
                    }

              });
        
        // function initProjectALL1(){
        //     var token=getUrlParam("tk");
        //     if(token!=""&&token!=undefined)
        //    $.ajax({
        //        url:"http://yn.skyimin-test3.com/wb/api/projectconfig/query/project/list?page=1&size=500",
        //        type:"get",
        //        headers: {
        //            "Authorization": "Bearer "+token 
        //        },
        //        contentType: 'application/json',
        //        success: function(res){
        //         console.log(res);
        //         var icon = null;
        //         if(res.success==true){
        //             projects = res.data.projectVOList;
        //             for(var i=0;i< res.data.projectVOList.length;i++){
        //             var proj= res.data.projectVOList[i];
        //             if(proj.property.lbs!=undefined&&proj.property.lbs!=""){
        //         switch(proj.property.jsztName){
        //         case"已建":
        //         icon = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/yijian.png",});break;
        //         case"在建":
        //         icon = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/zaijian.png",});break;
        //         case"拟建":
        //         icon = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/nijian.png",});break;
        //       }
        //                 var marker = L.marker([ proj.property.lbs.split(',')[0], proj.property.lbs.split(',')[1]], {
        //                               icon: icon,
        //                               attribution: i,
        //                               highlight: 'temporary'
        //                           }).addTo(layer_project);
        //                         marker.on({
        //                                     'mouseover': function (e) {
        //                                     e.target.bindTooltip("<div>" +projects[e.target.options.attribution*1].name + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
        //                                 },
        //                                     'mouseout': function (e) {
        //                                     e.target.closeTooltip();
        //                                         },
        //                                         'click': function (e) {
        //                                     loadPOIInfo(e.target.options.attribution*1,e.originalEvent.clientX,e.originalEvent.clientY);
        //                                 }}); 
        //             }}
        //         }
        //     }});
        // }
        
              //加载全部项目图标
        function initProjectALL1(){
        layer_project = new L.LayerGroup();
        var  cont={
            "dataset_list": [
              {
                "dataset_id": 1092,//1074,
                "field_list": [
                "VOLUME",
                  "FUND",
                  "SCALE",
                  "TYPE",
                  "LAT",
                  "LON",
                  "STACODE",
                  "NAME",
                  "PAC",
                  "ADNAME",
                  "SUMNAMBER",
                  "TYPE",
                  "DATA",
                  "UNCODE",
                  "STATUS",
                  "PRODATA",
                ],
                "filter":   flag_where
              }
            ],
            "query_define": {
              "bbox": {
                "rect_maxx": 105.630030074,
                "rect_miny": 21.577357499,
                "rect_minx": 97.639511463,
                "rect_maxy": 28.612581131
              },
              "crs": {
                "crsid": "EPSG:4326"
              }
            }
          };
          $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
          var icon_yijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/yijian.png",});
          var icon_zaijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/zaijian.png",});
          var icon_nijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/nijian.png",});
          layer_project = new L.LayerGroup();
      
          projects=  eval ("(" + res + ")");
          console.log(projects);
          for(var i=0;i<projects.result[0].features.length;i++){
              var project = projects.result[0].features[i];
       
              switch(project.properties.STACODE){
                case"已建":
                var marker = L.marker( [project.properties.LAT, project.properties.LON], {
                                      icon: icon_yijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_project);
                
                                  break;
                case"在建":
                var marker = L.marker( [project.properties.LAT, project.properties.LON], {
                                      icon: icon_zaijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_project);
                                  break;
                case"待建":
                var marker = L.marker( [project.properties.LAT, project.properties.LON], {
                                      icon: icon_nijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_project);
                                  break;
              }
              // marker.on("click", function (e) {//为marker绑定点击事件
              //   loadPOIInfo(e.target.options.attribution*1,e.originalEvent.clientX,e.originalEvent.clientY);});
          marker.on({
			        'mouseover': function (e) {
                    e.target.bindTooltip("<div>" +projects.result[0].features[e.target.options.attribution*1].properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
			        },
			        'mouseout': function (e) {
                    e.target.closeTooltip();
			        },
                    'click': function (e) {
                    loadPOIInfo(e.target.options.attribution*1,e.originalEvent.clientX,e.originalEvent.clientY);
                    }}); 
          }
           layer_project.addTo(map);
        },
        error:function(err){
            console.log(err);
           }
         });
       }
        //加载大型项目图标
        function initProject(){
            flag_where.push(["==","SCALE","大"]);
          var  cont={
            "dataset_list": [
              {
                "dataset_id": 1092,//1074,
                "field_list": [
                  "VOLUME",
                  "FUND",
                  "SCALE",
                  "TYPE",
                  "LAT",
                  "LON",
                  "STACODE",
                  "NAME",
                  "PAC",
                  "ADNAME",
                  "SUMNAMBER",
                  "TYPE",
                  "DATA",
                  "UNCODE",
                  "STATUS",
                  "PRODATA",
                ],
                "filter": flag_where
              }
            ],
            "query_define": {
              "bbox": {
                "rect_maxx": 105.630030074,
                "rect_miny": 21.577357499,
                "rect_minx": 97.639511463,
                "rect_maxy": 28.612581131
              },
              "crs": {
                "crsid": "EPSG:4326"
              }
            }
          };
          $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',

        success: function (res) {
          layer_project = new L.LayerGroup();
          var icon_yijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/yijian.png",});
          var icon_zaijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/zaijian.png",});
          var icon_nijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/nijian.png",});
          projects=  eval ("(" + res + ")");
          console.log(projects);
          for(var i=0;i<projects.result[0].features.length;i++){
              var project = projects.result[0].features[i];
              switch(project.properties.STACODE){
                case"已建":
                var marker = L.marker( [project.properties.LAT, project.properties.LON], {
                                      icon: icon_yijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_project);
                
                                  break;
                case"在建":
                var marker = L.marker( [project.properties.LAT, project.properties.LON], {
                                      icon: icon_zaijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_project);
                                  break;
                case"待建":
                var marker = L.marker( [project.properties.LAT, project.properties.LON], {
                                      icon: icon_nijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_project);
                                  break;
              }
        
          //     marker.on("click", function (e) {//为marker绑定点击事件
         
          //       loadPOIInfo(e.target.options.attribution*1,e.originalEvent.clientX,e.originalEvent.clientY); 
          // });
          marker.on({
			            'mouseover': function (e) {
                    e.target.bindTooltip("<div>" +projects.result[0].features[e.target.options.attribution*1].properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
			            
			            },
			            'mouseout': function (e) {
                    e.target.closeTooltip();
			            },
                  'click': function (e) {
                    loadPOIInfo(e.target.options.attribution*1,e.originalEvent.clientX,e.originalEvent.clientY);
                  }
			            }); 
                
          }
      
          layer_project.addTo(map);
        },
        error:function(err){
            console.log(err);
           }
         });
        }
        //点击图标弹窗
        function  loadPOIInfo(index,x,y){
          $("#pop").css("left",x).css("top",y);
                    var info=  projects.result[0].features[index].properties;
                    var str = ' <div class="title" >'+info.NAME+'<div id="getproInfo" style="float:right;font-size: 14px;">进入项目</div></div>';
                    str +='   <div class="warpper" >  <label class="high-light">库容：</label>  <span>'+info.VOLUME+'(MW)</span> </div>';
                    str +='   <div class="warpper" >  <label class="high-light">生产投资：</label>  <span>'+info.FUND+'(万元)</span> </div>';
                    str +='   <div class="warpper" >  <label class="high-light">搬迁安置人口：</label>  <span>'+""+'</span> </div>';
                    str +='   <div class="warpper" >  <label class="high-light">生产安置人口：</label>  <span>'+""+'</span> </div>';
                    $("#pop").html(str); 
                    $("#pop").show(500); 
                    $("#getproInfo").click(function(){
                    // zoomToProject(info);
                    if(projectCast[info.NAME]==undefined){alert("暂无位置信息");return;}
                    window.open("index_2D.html?projId="+projectCast[info.NAME],"");   
                  
                });
                }

        //加载市界
            function initXZQH(){
                var  cont={
                "dataset_list": [
                    {
                        "dataset_id": 1070,
                        "field_list": [
                            "PAC",
                            "NAME",
                            "DISPNAME",
                            "FULLNAME",
                            "UPPAC",
                            "UPNAME",
                            "BZ",
                            "XH",
                            "X",
                            "Y",
                            "SHAPE_Length",
                            "SHAPE_Area"
                        ]
                    }
                ],
                "query_define": {
                    "page_count": 20,
                    "page_num": 1
                }
            };
          $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?access_token=mk.7be49279ea411a18dd6aface64ede5a2&op=select",
        type: 'post',
        data: JSON.stringify(cont),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',

        success: function (res) {
         var shijie=  eval ("(" + res + ")");
          console.log(shijie);
          layer_xzqh = L.featureGroup([]).addTo(map);
          for(var i=0;i<shijie.result[0].features.length;i++){
              showVector(shijie.result[0].features[i].geometry.coordinates, '#ffff00', '#ffff00', 4, 2,0);//云南县级区划
              }
             
        },
        error:function(err){
            console.log(err);
           }
         });
        
}
        //显示矢量数据
        function showVector( coordinates, color, fillcolor, width, opacity,fillOpacity) {
                        if(coordinates[0].length==1)
                        coordinates = coordinates[0];
                            var nwkt = "POLYGON((";
                            for(var i=0;i<coordinates[0].length;i++){
                                if(i==coordinates[0].length-1)
                                nwkt += coordinates[0][i][0] + " " + coordinates[0][i][1];
                                else
                                nwkt += coordinates[0][i][0] + " " + coordinates[0][i][1]+",";
                            }
                            nwkt += "))";
                            var fea = omnivore.wkt.parse(nwkt);
                                fea.setStyle({
                                    color: color,
                                    opacity: opacity,
                                    fillColor: fillcolor,
                                    fillOpacity: fillOpacity,
                                    width: width,
                                    weight: opacity
                                });
                                layer_xzqh.addLayer(fea);
                    }
        //设置拟建在建待建查询条件
                var flag_where =["all"];
                function   initSql(){
                $(".legend-item-icon").click(function(){
                    if( $(this).css("background-color")=='rgba(0, 0, 0, 0)')
                        $(this).css("background-color",'rgba(255, 255, 255, 0.9)');
                    else
                        $(this).css("background",'rgba(0, 0, 0, 0)');
                    initflag_where();
                    layer_project.clearLayers();
                    initProjectALL1(); 
                });
                }
                function initflag_where(){
                    flag_where =["all"];
                if( $("#btn_zaijian").css("background-color")!='rgba(0, 0, 0, 0)')
                flag_where.push(["!=","STACODE","在建"]);  
                if( $("#btn_nijian").css("background-color")!='rgba(0, 0, 0, 0)')
                flag_where.push(["!=","STACODE","待建"]);  
                if( $("#btn_yijian").css("background-color")!='rgba(0, 0, 0, 0)')
                flag_where.push(["!=","STACODE","已建"]);  

                return flag_where;
                }
        //获取地址传值     
                function getUrlParam(name) {
                    console.log(window.location.search.substr(1).match(reg))
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                    var r = window.location.search.substr(1).match(reg); //匹配目标参数
                    if (r != null) return unescape(r[2]); return null; //返回参数值 
                }
                var arr_xzqhid =[532500000000,530100000000,530400000000,533400000000,530600000000,533300000000,530700000000,530300000000,532900000000,532300000000,530500000000,533100000000,530900000000,530800000000,532600000000,532800000000];
                var arr_xzqh =[ 
                ["红河哈尼族彝族自治州",532500000000,103.37329,23.36645],
                ["昆明市",530100000000,102.83172,24.88284],
                [ "玉溪市",530400000000,102.526021,24.350297],
                ["迪庆藏族自治州",533400000000,99.70091,27.8226],
                ["昭通市",530600000000,103.7146,27.34157],
                ["怒江傈僳族自治州",533300000000,98.8562,25.82092],
                ["丽江市",530700000000,	100.22526,26.85834],
                ["曲靖市",530300000000,103.794283,25.494057],
                ["大理白族自治州",532900000000,100.26652,25.60949],
                ["楚雄彝族自治州",32300000000,101.52666,25.04863],
                ["保山市",530500000000,	99.16087,25.11488],
                ["德宏傣族景颇族自治州",533100000000,98.58555,24.43633],
                ["临沧市",530900000000,100.087535,23.886691],
                ["普洱市",530800000000,100.96505,22.82819],
                ["文山壮族苗族自治州",532600000000,104.21329,23.40377],
                ["西双版纳傣族自治州",532800000000,100.79588,22.01206]
                ];
                var flag_Layer = true;
        //飞到行政区划
        function zoomToXzqh(xzqh){
            if(arr_xzqhid.indexOf(xzqh*1)!=-1){
            let center = [arr_xzqh[arr_xzqhid.indexOf(xzqh*1)][3],arr_xzqh[arr_xzqhid.indexOf(xzqh*1)][2]];
            map.setView(center,8);
            if(flag_Layer)initProjectALL1();else initHFLayer();

            }else
            if(flag_Layer)initProjectALL1();else initHFLayer();
        }

        //飞到项目
        function zoomToProject(info){
            map.setView([info.LAT,info.LON],10);
            $("#pop").hide(500); 
        layer_cmxz.clearLayers();
        for(var i=0;i<arr_jiandou.length;i++){
           // map.remove(  arr_jiandou[i]);
            arr_jiandou[i].hide();
        }
        arr_jiandou=[];

        var icon_yijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/yijian.png",});
         var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1096,//1022,
                "field_list": ["GID", "BID", "NOTE", "STATUS", "BJ", "X", "Y"],
                "filter": ["all",["==","GID",info.UNCODE]]}],//5e014c91dc694efda55628a92be479a5"5e014c91dc694efda55628a92be479a5"]]}],//
            "query_define":  {"page_count": 100, "page_num": 1},
              "crs": {
                "crsid": "EPSG:4326"
              }
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
          var jsonData=  eval ("(" + res + ")");
         
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
           addcunzu(poi.properties.BID);
         
          }

        },
        error:function(err){
            console.log(err);
           }
         });
        }
        function addcunzu(uccode){
         var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1093,//1024,
                "field_list": ["NAME", "PAC", "ADNAME", "SUMNAMBER", "NUMBER1", "TYPE", "DATA", "UNCODE", "COLLECTOR"],
                "filter": ["all",["==","UNCODE",uccode]]}],//5e014c91dc694efda55628a92be479a5
            "query_define": 
             {bbox: {rect_maxx: 105.630030074, rect_miny: 21.577357499, rect_minx: 97.639511463, rect_maxy: 28.612581131},
             crs: {crsid: "EPSG:4326"}}
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
        var icon_yijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/yijian.png",});
          var jsonData=  eval ("(" + res + ")");
         
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
            var marker = L.marker([ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]], {
                                      icon: icon_yijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_cmxz);
           //marker.bindTooltip("<div>" +poi.properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] });
           loadanzhi(poi.properties.UNCODE,[ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]]);
           //marker.on({'click': function (e) {loadanzhi(poi.properties.UNCODE,[ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]]);}}); 
           marker.on({
			        'mouseover': function (e) {
                    e.target.bindTooltip("<div>" +jsonData.result[0].features[e.target.options.attribution*1].properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
                    //e.target.openTooltip();
                },
			            'mouseout': function (e) {
                    e.target.closeTooltip();
			            }
			            }); 
          }

        },
        error:function(err){
            console.log(err);
           }
         });
        }
function loadanzhi(BID,startPOI){
          
    var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1097,//1023,
                "field_list": ["AID", "BID", "TYPE", "NUMBER1", "NOTE", "STATUS", "X", "Y"],
                "filter": ["all",["==","BID",BID]]}],//5e014c91dc694efda55628a92be479a5
            "query_define": 
             {bbox:  {"rect_miny": 59.944954, "rect_minx": 183.302752, "rect_maxy": 60.044954, "rect_maxx": 183.402752},
             crs: {crsid: "EPSG:4326"}}
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
        var icon_yijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/location1.png",});
          var jsonData=  eval ("(" + res + ")");
         
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
           addAnzhi(poi.properties.AID,startPOI);
          }
        },
        error:function(err){
            console.log(err);
           }
         });
        }
        var arr_jiandou = [];
  function addAnzhi(AID,startPOI){
    var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1095,//1020,
                "field_list":["NAME", "ADDRESS", "PAC", "ADNAME", "SUMNAMBER", "NUMBER1", "FROM1", "NOTE", "PRODATA", "COLLECTOR"],
                "filter": ["all",["==", "UNCODE", AID]]}],//5e014c91dc694efda55628a92be479a5
            "query_define": 
             {bbox:  {rect_maxy: 28.601194255, rect_maxx: 105.630030074, rect_miny: 21.478486988, rect_minx: 97.683532077},
             crs: {crsid: "EPSG:4326"}}
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
        var icon_yijian = L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/location1.png",});
          var jsonData=  eval ("(" + res + ")");
         
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
           //poi.properties.AID
            var marker = L.marker([ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]], {
                                      icon: icon_yijian,
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_cmxz);
           marker.bindTooltip("<div>" +poi.properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();


           var data = [{"from":[startPOI[1],startPOI[0]],"to":[ poi.geometry.coordinates[0],  poi.geometry.coordinates[1]],"labels":["",""],"color":"#ff3a31"}];
 
            var migrationLayer = new L.migrationLayer({
                map: map,
                data: data,
                pulseRadius:30,
                pulseBorderWidth:3,
                arcWidth:1,
                arcLabel:true,
                arcLabelFont:'10px sans-serif',
                }
            );
            migrationLayer.addTo(map); 
            arr_jiandou.push(migrationLayer);

          }
        },
        error:function(err){
            console.log(err);
           }
         });

  }

    function enterFullScreen() {
    var de = document.documentElement;
    if (de.requestFullscreen) {
        de.requestFullscreen();
    } else if (de.mozRequestFullScreen) {
        de.mozRequestFullScreen();
    } else if (de.webkitRequestFullScreen) {
        de.webkitRequestFullScreen();
    } else if (de.msRequestFullscreen){
    	de.msRequestFullscreen();
    }
}
//退出全屏
function exitFullScreen() {
    var de = document;
    if (de.exitFullscreen) {
        de.exitFullscreen();
    } else if (de.mozCancelFullScreen) {
        de.mozCancelFullScreen();
    } else if (de.webkitCancelFullScreen) {
        de.webkitCancelFullScreen();
    } else if (de.msExitFullscreen){
    	de.msExitFullscreen();
    }
}
//加载后扶数据
var data_HF;
function initHFLayer(){
    var token=getUrlParam("tk");
    if(token!=""&&token!=undefined)
           $.ajax({
               url:location.origin+"/wb/hf/project/dot/list?periodName=十四五",
               type:"get",
               headers: {
                   "Authorization": "Bearer "+token 
               },
               contentType: 'application/json',
               success: function(res){
                console.log(res);
               
                if(res.success==true){
                    data_HF = res.data;
                    for(var i=0;i< res.data.length;i++){
            var HFproj= res.data[i];
            var marker = L.marker([ HFproj.lbs.split(',')[0], HFproj.lbs.split(',')[1]], {
                                      icon: L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./img/iconHF.png",}),
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_hf);
           marker.on({
			        'mouseover': function (e) {
                    e.target.bindTooltip("<div>" +data_HF[e.target.options.attribution*1].projectName + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
                },
			        'mouseout': function (e) {
                    e.target.closeTooltip();
			            },
                        'click': function (e) {
                            loadHFInfo(e.target.options.attribution*1,e.originalEvent.clientX,e.originalEvent.clientY);
                  }
			            }); 
          }
                }

            }});
}
        //点击图标后扶弹窗
        function  loadHFInfo(index,x,y){
        
                    var info=  data_HF[index];
                    var str = ' <div class="title" >'+info.projectName+'<div id="getproInfo" style="float:right;font-size: 14px;color: #00C0FF">前往详情</div></div>';
                    str +='   <div class="warpper" >  <label class="high-light">项目编号：</label>  <span style="position: absolute;left: 40%;">'+info.projectNumber+'</span> </div>';
                    str +='   <div class="warpper" >  <label class="high-light">规划期：</label>  <span style="position: absolute;left: 40%;">'+info.periodName+'</span> </div>';
                    str +='   <div class="warpper" >  <label class="high-light">实施年度：</label>  <span style="position: absolute;left: 40%;">'+info.yearPlanList+'</span> </div>';
                    str +='   <div class="warpper" >  <label class="high-light">预算总投资：</label>  <span style="position: absolute;left: 40%;">'+info.budgetTotal+'  (万元)</span> </div>';
                    str +='   <div class="warpper" >  <label class="high-light">移民专项资金：</label>  <span style="position: absolute;left: 40%;">'+info.immigrationFund+'  (万元)</span> </div>';
                    var str_annualInvestmentList = "";
                    for(var a=0;a<info.annualInvestmentList.length;a++){
                        str_annualInvestmentList +=  info.annualInvestmentList[a].yearPlanName+' --  '+info.annualInvestmentList[a].annualInvestment+' (万元)\n'
                    }
                    if(str_annualInvestmentList == ""){
                        str_annualInvestmentList="--";
                        str +='   <div class="warpper">  <label class="high-light">年度投资情况：</label>  <span style="position:absolute;left: 40%;width:150px;">'+str_annualInvestmentList+'</span> </div>';
                    }else{
                        var temp_height = info.annualInvestmentList.length*23;
                        str +='   <div class="warpper" style="height:'+temp_height+'px">  <label class="high-light">年度投资情况：</label>  <span style="position:absolute;left: 40%; white-space:pre-wrap;height:'+temp_height+'px">'+str_annualInvestmentList+'</span> </div>';
                    }
                    $("#pop").html(str);
                    $("#pop").show(500); 
                    $("#getproInfo").click(function(){
                    window.open(location.origin+"/laterSupportMgr/prjManage/allProjects/detail?id="+info.id,"");   
                  
                });
                $("#pop").css("left",x+30).css("top",y-150);
                }
                
  </script>
<script >(function (window) {
    var utils = {
        // color:rgb或rgba格式
        // opacity: 透明度
        calculateColor: function (color, opacity) {
            if (color.indexOf('#') === 0) {
                var color16 = color.slice(1);
                var r = parseInt(color16.slice(0, 2), 16);
                var g = parseInt(color16.slice(2, 4), 16);
                var b = parseInt(color16.slice(4), 16);
                return 'rgba(' + r + ',' + g + ',' + b + ',' + opacity + ')';
            } else if (/^rgb\(/.test(color)) {
                return color.replace(/rgb/, 'rgba').replace(')', ",") +
                    opacity + ')';
            } else {
                return color.split(',').splice(0, 3).join(',') +
                    opacity + ')';
            }
        }
    };
    var arrayUtils = {
        forEach: function (arr, cb, scope) {
            if (typeof Array.prototype.forEach === 'function') {
                arr.forEach(cb, scope);
            } else {
                for (var i = 0, len = arr.length; i < len; i++) {
                    cb.apply(scope, [arr[i], i, arr]);
                }
            }
        },
        map: function (arr, cb, scope) {
            if (typeof Array.prototype.map === 'function') {
                return arr.map(cb, scope);
            } else {
                var mapped = [];
                for (var i = 0, len = arr.length; i < len; i++) {
                    mapped[i] = cb.apply(scope, [arr[i], i, arr]);
                }
                return mapped;
            }
        }
    };
 
    var Marker = (function () {
        var M = function (options) {
            this.x = options.x;
            this.y = options.y;
            this.rotation = options.rotation;
            this.style = options.style;
            this.color = options.color;
            this.size = options.size;
            this.borderWidth = options.borderWidth;
            this.borderColor = options.borderColor;
        };
 
        M.prototype.draw = function (context) {
            context.save();
            context.translate(this.x, this.y);
            context.rotate(this.rotation);
 
            context.lineWidth = this.borderWidth || 0;
            context.strokeStyle = this.borderColor || '#000';
            context.fillStyle = this.color || '#000';
            // 目前先只支持圆
            context.beginPath();
            if (this.style === 'circle') {
                context.arc(0, 0, this.size, 0, Math.PI * 2, false);
            } else if (this.style === 'arrow') {
                context.moveTo(-this.size, -this.size);
                context.lineTo(this.size, 0);
                context.lineTo(-this.size, this.size);
                context.lineTo(-this.size / 4, 0);
                context.lineTo(-this.size, -this.size);
            }
            context.closePath();
            context.stroke();
            context.fill();
            context.restore();
        };
 
        return M;
    })();
 
    var Arc = (function () {
        var A = function (options) {
            var startX = options.startX,
                startY = options.startY,
                endX = options.endX,
                endY = options.endY;
            //两点之间的圆有多个，通过两点及半径便可以定出两个圆，根据需要选取其中一个圆
            var L = Math.sqrt(Math.pow(startX - endX, 2) + Math.pow(startY - endY, 2));
            var m = (startX + endX) / 2; // 横轴中点
            var n = (startY + endY) / 2; // 纵轴中点
            var factor = 1.5;
 
            var centerX = (startY - endY) * factor + m;
            var centerY = (endX - startX) * factor + n;
 
            var radius = Math.sqrt(Math.pow(L / 2, 2) + Math.pow(L * factor, 2));
            var startAngle = Math.atan2(startY - centerY, startX - centerX);
            var endAngle = Math.atan2(endY - centerY, endX - centerX);
 
            // this.L = L;
            this.startX = startX;
            this.startY = startY;
            this.endX = endX;
            this.endY = endY;
            this.centerX = centerX;
            this.centerY = centerY;
            this.startAngle = startAngle;
            this.endAngle = endAngle;
            this.startLabel = options && options.labels && options.labels[0],
                this.endLabel = options && options.labels && options.labels[1],
                this.radius = radius;
            this.lineWidth = options.width || 1;
            this.strokeStyle = options.color || '#000';
            this.label = options.label;
            this.font = options.font;
            this.shadowBlur = options.shadowBlur;
        };
 
        A.prototype.draw = function (context) {
            context.save();
            context.lineWidth = this.lineWidth;
            context.strokeStyle = this.strokeStyle;
            context.shadowColor = this.strokeStyle;
            context.shadowBlur = this.shadowBlur || 2;
 
            context.beginPath();
            context.arc(this.centerX, this.centerY, this.radius, this.startAngle, this.endAngle, false);
            context.stroke();
            context.restore();
 
            context.save();
            context.fillStyle = this.strokeStyle;
            if (this.label) {
                context.font = this.font;
                if (this.startLabel) {
                    var x = this.startX - 15
                    var y = this.startY + 5
                    context.fillText(this.startLabel, x, y);
                }
                if (this.endLabel) {
                    var x = this.endX - 15;
                    var y = this.endY - 5;
                    context.fillText(this.endLabel, x, y);
                }
            }
            context.restore();
        };
 
        return A;
    })();
 
    var Pulse = (function () {
        function P(options) {
            this.x = options.x;
            this.y = options.y;
            this.maxRadius = options.radius;
            this.color = options.color;
            this.shadowBlur = 5;
            this.lineWidth = options.borderWidth;
            this.r = 0;
            this.factor = 2 / options.radius;
        };
 
        P.prototype.draw = function (context) {
            // var vr = (this.maxRadius - this.r) * this.factor;
            var vr = 0.5;
            this.r += vr;
            // this.shadowBlur = Math.floor(this.r);
 
            context.save();
            context.translate(this.x, this.y);
            var strokeColor = this.color;
            strokeColor = utils.calculateColor(strokeColor, 1 - this.r / this.maxRadius);
            context.strokeStyle = strokeColor;
            context.shadowBlur = this.shadowBlur;
            context.shadowColor = strokeColor;
            context.lineWidth = this.lineWidth;
            context.beginPath();
            context.arc(0, 0, this.r, 0, Math.PI * 2, false);
            context.stroke();
            context.restore();
 
            if (Math.abs(this.maxRadius - this.r) < 0.8) {
                this.r = 0;
            }
        }
 
        return P;
    })();
 
    var Spark = (function () {
        var S = function (options) {
            var startX = options.startX,
                startY = options.startY,
                endX = options.endX,
                endY = options.endY;
 
            //两点之间的圆有多个，通过两点及半径便可以定出两个圆，根据需要选取其中一个圆
            var L = Math.sqrt(Math.pow(startX - endX, 2) + Math.pow(startY - endY, 2));
            var m = (startX + endX) / 2; // 横轴中点
            var n = (startY + endY) / 2; // 纵轴中点
            var factor = 1.5;
 
            var centerX = (startY - endY) * factor + m;
            var centerY = (endX - startX) * factor + n;
 
            var radius = Math.sqrt(Math.pow(L / 2, 2) + Math.pow(L * factor, 2));
            var startAngle = Math.atan2(startY - centerY, startX - centerX);
            var endAngle = Math.atan2(endY - centerY, endX - centerX);
 
            // 保证Spark的弧度不超过Math.PI
            if (startAngle * endAngle < 0) {
                if (startAngle < 0) {
                    startAngle += Math.PI * 2;
                    endAngle += Math.PI * 2;
                } else {
                    endAngle += Math.PI * 2;
                }
            }
 
            this.tailPointsCount = 50; // 拖尾点数
            this.centerX = centerX;
            this.centerY = centerY;
            this.startAngle = startAngle;
            this.endAngle = endAngle;
            this.radius = radius;
            this.lineWidth = options.width || 1;
            this.strokeStyle = options.color || '#fff';
            this.factor = 2 / this.radius;
            this.deltaAngle = (80 / Math.min(this.radius, 400)) / this.tailPointsCount;
            this.trailAngle = this.startAngle;
            this.arcAngle = this.startAngle;
 
            this.animateBlur = true;
 
            this.marker = new Marker({
                x: 50,
                y: 80,
                rotation: 50 * Math.PI / 180,
                style: 'arrow',
                color: 'rgb(255, 255, 255)',
                size: 3,
                borderWidth: 0,
                borderColor: this.strokeStyle
            });
        };
 
        S.prototype.drawArc = function (context, strokeColor, lineWidth, startAngle, endAngle) {
            context.save();
            context.lineWidth = lineWidth;
            // context.lineWidth = 5;
            context.strokeStyle = strokeColor;
            context.shadowColor = this.strokeStyle;
            // context.shadowBlur = 5;
            context.lineCap = "round";
            context.beginPath();
            context.arc(this.centerX, this.centerY, this.radius, startAngle, endAngle, false);
            context.stroke();
            context.restore();
        };
 
        S.prototype.draw = function (context) {
            var endAngle = this.endAngle;
            // 匀速
            var angle = this.trailAngle + this.factor;
            var strokeColor = this.strokeStyle;
            if (this.animateBlur) {
                this.arcAngle = angle;
            }
            this.trailAngle = angle;
            strokeColor = utils.calculateColor(strokeColor, 0.1);
 
            this.drawArc(context, strokeColor, this.lineWidth, this.startAngle, this.arcAngle);
 
            // 拖尾效果
            var count = this.tailPointsCount;
            for (var i = 0; i < count; i++) {
                var arcColor = utils.calculateColor(this.strokeStyle, 0.3 - 0.3 / count * i);
                var tailLineWidth = 5;
                if (this.trailAngle - this.deltaAngle * i > this.startAngle) {
                    this.drawArc(context, arcColor,
                        tailLineWidth - tailLineWidth / count * i,
                        this.trailAngle - this.deltaAngle * i,
                        this.trailAngle
                    );
                }
            }
 
            context.save();
            context.translate(this.centerX, this.centerY);
            this.marker.x = Math.cos(this.trailAngle) * this.radius;
            this.marker.y = Math.sin(this.trailAngle) * this.radius;
            this.marker.rotation = this.trailAngle + Math.PI / 2;
            this.marker.draw(context);
            context.restore();
 
            if ((endAngle - this.trailAngle) * 180 / Math.PI < 0.5) {
                this.trailAngle = this.startAngle;
                this.animateBlur = false;
            }
        };
 
        return S;
    })();
 
 
    var Migration = (function () {
        var M = function (options) {
            this.data = options.data;
            this.store = {
                arcs: [],
                markers: [],
                pulses: [],
                sparks: []
            };
            this.playAnimation = true;
            this.started = false;
            this.context = options.context;
            this.style = options.style;
            this.init();
        };
 
        M.prototype.init = function () {
            this.updateData(this.data);
        };
        /*
         * Shape 必须拥有draw方法
        */
        M.prototype.add = function (Shape) {
 
        };
        M.prototype.remove = function () {
 
        };
        M.prototype.clear = function () {
            this.store = {
                arcs: [],
                markers: [],
                pulses: [],
                sparks: []
            };
            // 更新状态
            this.playAnimation = true;
            this.started = false;
            // 清除绘画实例，如果没有这个方法，多次调用start，相当于存在多个动画队列同时进行
            window.cancelAnimationFrame(this.requestAnimationId);
        };
        /*
         * 更新数据
        */
        M.prototype.updateData = function (data) {
            if (!data || data.length === 0) {
                return;
            }
            this.clear();
            this.data = data;
            if (this.data && this.data.length > 0) {
                arrayUtils.forEach(this.data, function (element) {
                    var arc = new Arc({
                        startX: element.from[0],
                        startY: element.from[1],
                        endX: element.to[0],
                        endY: element.to[1],
                        labels: element.labels,
                        label: this.style.arc.label,
                        font: this.style.arc.font,
                        width: this.style.arc.width,
                        color: element.color
                    });
                    var marker = new Marker({
                        x: element.to[0],
                        y: element.to[1],
                        rotation: arc.endAngle + Math.PI / 2,
                        style: 'arrow',
                        color: element.color,
                        size: 4,
                        borderWidth: 0,
                        borderColor: element.color
                    });
                    var pulse = new Pulse({
                        x: element.to[0],
                        y: element.to[1],
                        radius: this.style.pulse.radius,
                        color: element.color,
                        borderWidth: this.style.pulse.borderWidth
                    });
                    var spark = new Spark({
                        startX: element.from[0],
                        startY: element.from[1],
                        endX: element.to[0],
                        endY: element.to[1],
                        width: 15,
                        color: element.color
                    });
 
                    this.store.arcs.push(arc);
                    this.store.markers.push(marker);
                    this.store.pulses.push(pulse);
                    this.store.sparks.push(spark);
                }, this);
            }
        };
        /*
        */
        M.prototype.start = function (canvas) {
            var that = this;
            if (!this.started) {
                (function drawFrame() {
                    that.requestAnimationId = window.requestAnimationFrame(drawFrame, canvas);
 
                    if (that.playAnimation) {
                        canvas.width += 1;
                        canvas.width -= 1;
                        for (var p in that.store) {
                            var shapes = that.store[p];
                            for (var i = 0, len = shapes.length; i < len; i++) {
                                shapes[i].draw(that.context);
                            }
                        }
                    }
                })();
                this.started = true;
            }
        };
        M.prototype.play = function () {
            this.playAnimation = true;
        };
        M.prototype.pause = function () {
            this.playAnimation = false;
        };
        return M;
    })();
 
    L.MigrationLayer = L.Class.extend({
        options: {
            map: {},
            data: {},
            pulseRadius: 25,
            pulseBorderWidth: 3,
            arcWidth: 1,
            arcLabel: true,
            arcLabelFont: '15px sans-serif',
            Marker: {},
            Spark: {}
 
        },
        _setOptions: function (obj, options) {
            if (!obj.hasOwnProperty('options')) {
                obj.options = obj.options ? L.Util.create(obj.options) : {};
            }
            for (var i in options) {
                obj.options[i] = options[i];
            }
            return obj.options;
        },
        initialize: function (options) {
            this._setOptions(this, options);
            this._map = this.options.map || {};
            this._data = this.options.data || {};
            this._style = {
                pulse: {
                    radius: this.options.pulseRadius,
                    borderWidth: this.options.pulseBorderWidth
                },
                arc: {
                    width: this.options.arcWidth,
                    label: this.options.arcLabel,
                    font: this.options.arcLabelFont
                }
            } || {};
            this._show = true;
            this._init();
        },
        _init: function () {
            var container = L.DomUtil.create('div', 'leaflet-ODLayer-container');
            container.style.position = 'absolute';
            container.style.width = this._map.getSize().x + "px";
            container.style.height = this._map.getSize().y + "px";
 
            this.container = container;
 
            this.canvas = document.createElement('canvas');
            this.context = this.canvas.getContext('2d');
            container.appendChild(this.canvas);
            this._map.getPanes().overlayPane.appendChild(container);
            //this._resize();
            if (!this.migration) {
                var data = this._convertData();
                this.migration = new Migration({
                    data: data,
                    context: this.context,
                    style: this._style
                });
                //this._draw();
                //this._bindMapEvents();
            }
        },
        _resize: function () {
            var bounds = this._map.getBounds();
            var topleft = bounds.getNorthWest();
            var topLeftscreen = this._map.latLngToContainerPoint(topleft);
            //当地图缩放或者平移到整个地图的范围小于外层容器的范围的时候，要对this.container进行上下平移操作，反之则回归原位
            if (topLeftscreen.y > 0) {
                this.container.style.top = -topLeftscreen.y + 'px';
            } else {
                this.container.style.top = '0px';
            }
 
            var containerStyle = window.getComputedStyle(this._map.getContainer());
            this.canvas.setAttribute('width', parseInt(containerStyle.width, 10));
            this.canvas.setAttribute('height', parseInt(containerStyle.height, 10));
        },
        _convertData: function () {
            var bounds = this._map.getBounds();
 
            if (this._data && bounds) {
                var data = arrayUtils.map(this._data, function (d) {
 
                    var fromPixel = this._map.latLngToContainerPoint(new L.LatLng(d.from[1], d.from[0]));
                    var toPixel = this._map.latLngToContainerPoint(new L.LatLng(d.to[1], d.to[0]));
                    return {
                        from: [fromPixel.x, fromPixel.y],
                        to: [toPixel.x, toPixel.y],
                        labels: d.labels,
                        value: d.value,
                        color: d.color
                    }
                }, this);
 
                return data;
            }
        },
        _bindMapEvents: function () {
            var that = this;
            // window.onresize = function () {
            //     that._resize();
            // };
            // this._map.on('movestart ', function () {
            //     that.migration.pause();
            // });
            this._map.on('moveend', function () {
                that.migration.play();
                that._draw();
            });
            this._map.on('zoomstart ', function () { that.container.style.display = 'none' });
            this._map.on('zoomend', function () {
                if (that._show) {
                    that.container.style.display = ''
                    that._draw();
                }
            });
        },
        _draw: function () {
            var bounds = this._map.getBounds();
            if (bounds && this.migration.playAnimation) {
                this._resize();
                this._transform();
                var data = this._convertData();
                this.migration.updateData(data);
                this.migration.start(this.canvas);
            }
        },
        _transform: function () {
            var bounds = this._map.getBounds();
            var topLeft = this._map.latLngToLayerPoint(bounds.getNorthWest());
            L.DomUtil.setPosition(this.container, topLeft);
        },
        addTo: function () {
            this._bindMapEvents();
            var bounds = this._map.getBounds();
            if (bounds && this.migration.playAnimation) {
                this._resize();
                this._transform();
 
                var data = this._convertData();
                this.migration.updateData(data);
                this.migration.start(this.canvas);
            }
        },
        setData: function (data) {
            this._data = data;
            this._draw();
        },
        hide: function () {
            this.container.style.display = 'none';
            this._show = false;
        },
        show: function () {
            this.container.style.display = '';
            this._show = true;
        },
        play: function () {
            this.migration.play();
        },
        pause: function () {
            this.migration.pause();
        },
        destroy: function () {
            this.migration.clear();
            //移除dom
            this.container.parentNode.removeChild(this.container);
            //移除事件监听
            this._map.clearAllEventListeners();
            this.mapHandles = [];
        }
 
    });
    L.migrationLayer = function (options) {
        return new L.MigrationLayer(options)
    }
})(window)
 </script>
  <script src="Config_project.js"></script>
</body>

</html>