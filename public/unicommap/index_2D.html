<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>征迁平台三维地图</title>

   <!-- 基础引用 -->
    <link href="index/fonts/iconfont/iconfont.css" rel="stylesheet" />
    <link href="index/css/animate.min.css" rel="stylesheet" />
    <link href="index/css/elmentuis.css" rel="stylesheet" />
    <link href="index/css/index.css" rel="stylesheet" />
    <link href="index/css/num1.css" rel="stylesheet" />

    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="index_basinMap.css" />
    <link href="index/css/index.css" rel="stylesheet" />
    <link href="index/fonts/iconfont/iconfont.css" rel="stylesheet" />
    <link href="index/css/animate.min.css" rel="stylesheet" />
    <link href="index/css/num1.css" rel="stylesheet" />
    <link href="css/pretty.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/mapProject.css" />
    <link rel="stylesheet" href="index/css/index.css" />
    <!-- 老平台对接 --> 
    <script src="index/js/echarts.min.js"></script>
    <script src="leaflet/leaflet.js"></script>
    <link href="leaflet/leaflet.css" rel="stylesheet" />
    <script src="leaflet/leaflet-src.js"></script>
    <script src="leaflet/leaflet-omnivore.min.js"></script>
    <script src="leaflet/leaflet-ant-path.js"></script>
    <!-- <script src="leaflet/leaflet.marker.highlight.js"></script> -->
    <script src="leaflet/Control.MiniMap.min.js"></script>
    <script src="leaflet/Label.js"></script>
    <script src="leaflet/BaseMarkerMethods.js"></script>
    <script src="leaflet/CircleMarker.Label.js"></script>
    <script src="leaflet/Map.Label.js"></script>
    <!-- <script src="index/js/jquery.js"></script> -->
  <script src="index/js/echarts.min.js"></script>
  <script src="jquery-1.10.2.js"></script>
  <link rel="stylesheet" type="text/css" href="jQueryDropdown/jquery.dropdown.min.css">
  <script src="jQueryDropdown/jquery.dropdown.min.js"></script>
 <style>
    .fullScreen {
    position: absolute;
    top: 15px;
    right: 288px;
    width: 40px;
    height: 40px;
    padding: 4px;
    background: rgba(22,91,176,0.9);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    box-sizing: border-box;
    z-index: 1000;
}
 
                select {
            background-color: transparent;
            color: #ffffff;
            border: none;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 20px;
            outline: none;
        }
        .sand-body {
            font-family: PingFang SC;
            font-size: 14px;
            font-style: normal;
            font-weight: normal;
            color: rgba(255, 255, 255, 0.85);
        }
    
        .sand-body .unit {
            margin-left: 13px;
        }
    
        .sand-body select {
            background-color: transparent;
            color: #ffffff;
            border: none;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 20px;
            outline: none;
        }
    
        .sand-body .options {
            position: relative;
        }
        .sand-body .options:after {
            content: "";
            width: 0;
            height: 0;
            border-left: 3px solid transparent;
            border-right: 3px solid transparent;
            border-top: 5px solid #ffffff;
            /*通过定位将图标放在合适的位置*/
            position: absolute;
            right: 0px;
            top: 41%;
            /*给自定义的图标实现点击下来功能*/
            pointer-events: none;
        }
    
        .sand-body p {
            margin: 0px;
        }
    
        .sand-body {
            color: #00C0FF;
        }
        .high-light {
            min-width: 150px;
            color: #00C0FF;
        }
    
        .sand-body hr.gradient {
            margin-top: 0px;
            background: radial-gradient(50% 50% at 50% 50%, rgba(0, 192, 255, 0.5) 57.81%, rgba(10, 244, 251, 0) 100%);
        }
    
        .sand-body .mock-border {
            border: none;
            height: 1px;
            position: absolute;
            left: 0px;
            right: 0px;
        }
    
        .sand-body .title {
            color: #ffffff;
            font-size: 18px;
        }
    
        .sand-body .ellipse,
        .sand-body .ellipse li {
            overflow:scroll;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
    
        /* .sand-body .ellipse:hover, 
        .sand-body .ellipse li:hover {
            overflow: visible;
        } */
        ul {
            list-style-type: none;
            margin: 0px;
            padding: 0px;
        }
    
        .back-contanier {
            position: relative;
            background-color: rgba(5, 38, 75, 0.6);
            color: rgba(255, 255, 255, 0.85);
            border-radius: 4px;
            padding: 8px 16px;
        }
        /** 启用 begin**/
        .refresh-container {
            width: 94px;
            height: 42px;
            padding-top: 9px;
            padding-bottom: 0px;
        }
        .refresh-container img {
            width: 32px;
            height: 32px;
            line-height: 32px;
            cursor: pointer;
        }
        .refresh-container img:first-child {
            margin-right: 16px;
        }
        /** 启用 end**/
        .container-with-padding {
            padding: 8px 16px;
        }
    
        .primary-color {
            color: rgba(255, 255, 255, 0.85);
        }
    
        /** 导航begin **/
        .nav-container {
            width: 100%;
            height: 76px;
            background: url(./icons/header.png) no-repeat;
            background-size: cover;
            display: flex;
            padding: 0 26px;
            align-items: center;
        }
    
        .nav-container .header-left {
            width: 33%;
            display: flex;
            position: relative;
        }
    
        .nav-container .header-left .yunnan-logo {
            width: calc(50% - 10px);
        }
    
        .nav-container .yunnan-logo {
            font-size: 20px;
        }
    
        .nav-container .yuan-logo {
            font-size: 16px;
            margin-left: 10%;
        }
    
        .nav-container .yunnan-logo,
        .nav-container .yuan-logo {
            height: 26px;
            margin-right: 10px;
            position: relative;
            width: 50%;
        }
    
        .nav-container .yunnan-logo::before,
        .nav-container .yuan-logo::before {
            content: '';
            width: 33px;
            height: 27px;
            display: inline-block;
            position: relative;
            top: 5px;
            background: url(./icons/yunnanLogo.png) no-repeat;
            background-size: cover;
        }
    
        .nav-container .yuan-logo::before {
            background: url(./icons/yuan.png) no-repeat;
            top: 8px;
        }
    
        .nav-container .header-left .split {
            width: 1px;
            height: 16px;
            display: inline-block;
            background: rgba(0, 192, 255, 0.65);
            position: absolute;
            left: 46%;
            top: 13px;
        }
    
        .nav-container .header-title {
            font-family: PingFang SC;
            font-style: normal;
            font-weight: 600;
            font-size: 30px;
            line-height: 52px;
            /* width: 384px; */
            width: 20%;
            background-image: -webkit-linear-gradient(bottom, #22BAED, #22BAED, #D6EBFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: ABSOLUTE;
            left: 50%;
            margin-left: -192px;
            text-align: center;
        }
    
        .nav-container .header-right {
            display: flex;
            flex-wrap: nowrap;
            position: absolute;
            left: 69%;
            bottom: 0px;
        }
    
        .nav-container .header-right li {
            width: 140px;
            height: 55px;
            line-height: 55px;
            text-align: center;
            color: rgba(255, 255, 255, 0.65);
        }
    
        .nav-container .header-right  {
            color: #fff;
            font-family: PingFang SC;
            font-size: 16px;
            /* background: linear-gradient(180deg, rgba(0, 148, 255, 0.4) 0%, rgba(0, 192, 255, 0) 123.81%); */
        }
        .active{
            cursor:pointer;
        }
        .active:hover{
            color: #fff;
            font-family: PingFang SC;
            background: linear-gradient(180deg, rgba(0, 148, 255, 0.4) 0%, rgba(0, 192, 255, 0) 123.81%);

        }
        /** 导航end **/
        /** 角 begin **/
        .angle {
            position: absolute;
            width: 15px;
            height: 15px;
        }
    
        .angle-left-top {
            top: -2px;
            left: -2px;
            border-left: 4px solid #00C0FF;
            border-top: 4px solid #00C0FF;
        }
    
        .angle-right-top {
            top: -2px;
            right: -2px;
            border-right: 4px solid #00C0FF;
            border-top: 4px solid #00C0FF;
        }
    
        .angle-left-bottom {
            bottom: -2px;
            left: -2px;
            border-bottom: 4px solid #00C0FF;
            border-left: 4px solid #00C0FF;
        }
    
        .angle-right-bottom {
            bottom: -2px;
            right: -2px;
            border-right: 4px solid #00C0FF;
            border-bottom: 4px solid #00C0FF;
        }
    
        /** 角 end **/
    
        .nav li {
            background: rgba(0, 192, 255, 0.2);
            border: 1px solid #00C0FF;
            box-sizing: border-box;
            border-radius: 4px;
            height: 36px;
            line-height: 36px;
            width: 100%;
            margin-bottom: 16px;
            cursor: pointer;
            padding: 0 10px;
            color: rgba(254, 255, 255, 0.85);
        }
    
        .nav li.active {
            border-color: #00C0FF;
            color: #ffffff;
            background: rgba(0, 192, 255, 0.65);;
        }
    
        .nav li img {
            margin-right: 9px;
        }
    
        /* .left-nav-container {
            width: 192px;
            height: 234px;
            padding: 16px;
        } */
    
        /** 左侧导航 begin **/
        .left-nav-container {
            width: 308px;
            padding: 16px;
        }
    
        .left-nav-title {
            width: 180px;
            height: 24px;
            font-weight: 500;
            font-size: 16px;
            color: #fff;
            position: relative;
            padding-left: 16px;
            background: linear-gradient(89.95deg, rgba(0, 192, 255, 0.55) -72.95%, rgba(196, 196, 196, 0) 102.45%);
        }
    
        .left-nav-title::before {
            content: '';
            display: inline-block;
            position: absolute;
            left: 0px;
            width: 4px;
            height: 24px;
            background: rgba(0, 192, 255, 0.85);
        }
    
        .left-nav-header>div {
            margin-top: 16px;
            display: flex;
        }
    
        .left-nav-header span {
            color: #ffffff;
            display: block;
            width: 250px;
        }
    
        .left-nav-body {
            background: rgba(0, 192, 255, 0.2);
            border: 1px dashed rgba(0, 192, 255, 0.65);
            box-sizing: border-box;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding-top: 25px;
            margin-top: 16px;
        }
    
        .left-nav-body li {
            width: calc(100% / 3 - 10px);
            height: 50px;
            text-align: center;
            padding: 0 5px;
            align-items: center;
            margin-bottom: 30px;
            align-content: flex-start;
            vertical-align: middle;
        }
    
        .left-nav-body li b {
            font-size: 16px;
            color: rgba(0, 255, 194, 0.8);
        }
    
        .left-nav-body li div {
            color: #fff;
            font-size: 12px;
        }
    
        .more-body {
            margin-top: 24px;
        }
    
        .more-body .left-nav-body {
            background: rgba(37, 91, 218, 0.2);
            border: 1px dashed rgba(109, 159, 255, 0.65);
        }
    
        .more-body .left-nav-body li b {
            color: #82ACFF;
        }
    
        .left-nav {
            padding-bottom: 0px;
        }
    
        .left-nav li {
            font-size: 16px;
            line-height: 30px;
            height: 32px;
        }
    
        .turn-on {
            height: 58px;
            line-height: 56px;
        }
    
        .turn-on img {
            margin-top: 16px;
            margin-right: 22px;
            cursor: pointer;
        }
    
        .turn-on img:first-child {
            margin-left: 16px;
        }
    
        /** 左侧导航 end **/
    
        /** 右侧头部导航 begin **/
        .right-head-nav {
            width: 394px;
            display: flex;
            padding: 7px 0px;
        }
    
        .right-head-nav img {
            position: relative;
            top: 2px;
            margin-left: 8px;
        }
    
        .right-head-nav .projects select {
            width: 165px;
            cursor: pointer;
        }
    
        .right-head-nav .water-line {
            position: relative;
            padding: 0 8px;
            cursor: pointer;
        }
    
        .right-head-nav .water-line select {
            width: 95px;
        }
    
        .right-head-nav .water-line::before,
        .right-head-nav .water-line::after {
            content: '';
            display: block;
            width: 1px;
            height: 16px;
            background: rgba(0, 192, 255, 0.4);
            position: absolute;
            top: 2px
        }
    
        .right-head-nav .water-line::before {
            left: 8px;
        }
    
        .right-head-nav .water-line::after {
            right: 0px;
        }
    
        .right-head-nav .full-screen {
            width: 60px;
            cursor: pointer;
        }
    
        /** 右侧头部导航 end **/
    
        /** 右侧导航 begin **/
        .right-nav-container {
           /*  width: 343px;
            height: 380px; */
            display: flex;
            padding: 0px;
            line-height: 34px;
            color: rgba(254, 255, 255, 0.85);
            background: rgba(5, 38, 75, 0.6);
        }
    
        .right-nav-container li {
            border-color: transparent;
            padding-right: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            overflow: hidden;
        }
    
        .right-nav-container li:hover {
            border-color: #00C0FF;
            color: #ffffff;
            background: rgba(5, 38, 75, 0.8);
        }
    
        .right-nav-container .left,
        .right-nav-container .right {
            padding: 16px;
        }
    
        .right-nav-container .left {
            max-height: 393px;
            overflow:auto;
            width: 234px;
            border-right: 1px solid rgba(0, 192, 255, 0.2);
            ;
        }
    
        .right-nav-container .right embed {
            position: relative;
            top: 3px;
            margin-right: 7px;
        }
    
        /** 右侧导航 end **/
    
        /** 经纬度 begin **/
        .lbs-container {
            width: 190px;
            height: 20px;
            line-height: 20px;
        }
    
        .lbs-container .lat {
            margin-left: 16px;
        }
    
        /** 经纬度 end **/
    
        /** 左侧统计信息栏 beigin **/
        .facility-info-container {
            width: 266px;
            padding-left: 8px;
            padding-right: 8px;
        }
    
        .facility-info-container .title {
            font-weight: 500;
            margin-bottom: 3px;
        }
        .facility-info-container hr {
            background: rgba(0, 192, 255, 0.2);
            margin: 0px;
        }
    
        .facility-info-container p {
            padding-top: 4px;
        }
    
        /** 左侧统计信息栏 end **/
    
        /** 专属设施弹窗 beigin **/
        .facility-modal-container {
            width: 432px;
            padding: 16px 22px;
            border: 1px solid #00C0FF;
        }
        .facility-modal-container .mock-border {
            background-color: rgba(0, 192, 255, 0.2);
            top: 40px;
        }
        .facility-modal-container>div {
            /* //display: flex; */
            margin-bottom: 16px;
        }
    
        .facility-modal-container>div:last-child {
            margin-bottom: 0px;
        }
    
        .facility-modal-container>div label {
            width: 90px;
            min-width: 90px;
            text-align: right;
            margin-right: 5px;
        }
    
        /** 专属设施弹窗 end **/
    
        /** 安置点人信息 end **/
        .arrange-person-container {
            width: 436px;
            height: 690px;
            padding-left: 32px;
            padding-right: 32px;
        }
    
        .arrange-person-container .basic-info {
            display: flex;
            margin-bottom: 24px;
        }
    
        .arrange-person-container img {
            width: 130px;
            height: 200px;
            margin-right: 16px;
        }
    
        .arrange-person-container .basic-info-txt>div {
            margin-bottom: 16px;
        }
    
        .arrange-person-container .basic-info-txt>div:last-child {
            margin-bottom: 0px;
        }
    
        .arrange-person-container hr {
            background: rgba(0, 192, 255, 0.2);
            margin: 0px;
        }
    
        .arrange-person-container .carousel {
            padding-top: 17px;
        }
    
        .arrange-person-container .carousel li {
            display: inline-block;
            border-bottom: 2px solid transparent;
            padding: 2px 5px;
        }
    
        .arrange-person-container .carousel li.active {
            border-color: #00C0FF;
            color: #ffffff;
        }
    
        .arrange-person-container .carousel-content {
            margin-top: 40px;
        }
    
        .arrange-person-container .carousel-content ul {
            display: flex;
        }
    
        .arrange-person-container .carousel-content li {
            width: 432px;
        }
    
        .arrange-person-container .carousel-content img {
            width: 100%;
            height: 252px;
        }
    
        /** 安置点人信息 end **/
    
        /** 村落信息栏 beigin **/
        .town-container {
            width: 402px;
            color: rgba(255, 255, 255, 0.85);
        }
    
        .town-container .aim-body {
            display: flex;
        }
    
        .town-container .aim {
            width: calc(100% - 70px);
        }
    
        .town-container .aim>div {
            position: relative;
        }
    
        .town-container .aim label {
            margin-right: 5px;
        }
    
        .town-container .aim .split {
            content: '';
            display: inline-block;
            width: 1px;
            height: 11px;
            left: 190px;
            top: 9px;
            position: absolute;
            background: #FFFFFF;
            opacity: 0.2;
        }
    
        .town-container .count {
            display: inline-block;
            width: 40px;
            top: 5px;
            position: relative;
            text-align: right;
        }
    
        .town-container .warpper {
            margin-bottom: 16px;
        }
    
        .town-container .unit {
            margin-right: 20px;
        }
    
        /** 村落信息栏 end **/
    
        /** 大坝弹窗 begin **/
        .dam-container {
            width: 420px;
            height: 568px;
            padding: 10px 40px;
        }
    
        .dam-container .basic-info {
            text-indent: 25px;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 16px;
        }
    
        .dam-container .title {
            padding: 16px 0px;
        }
        .camera{
            position: relative;
            bottom: 50px;
            right:10px;
                float:right;
                margin: 0px;
                padding-top: 10px;
        }
         /** 大坝弹窗 end **/
    </style>
    <!-- Cesium -->
</head>
<body>
<div id="mapDiv" style="width:100%;height:100%;z-index: 10;"></div>
<div  class="back-contanier nav-container" style="position: absolute;left:0px;top:0px;z-index: 99;">
    <div class="header-left">
        <div class="yunnan-logo">云南省搬迁安置办公室</div>
        <span class="split"></span>
        <div class="yuan-logo" style="right:30px">华东勘测设计研究院有限公司</div>
    </div>
    <div class="header-title">项目电子沙盘</div>
    <ul class="header-right" style="display:none">
        <li  id="zoom" class="active">坝址飞行路线</li>
        <li id="bazhi" class="active">淹没区一览</li>
        <li id="play" class="active">坝址往库尾漫游</li>
        <li id="anzhi" class="active">安置去向一览</li>
    </ul>
</div>
    <!-- 启用 开始 -->
    <div id="leftBar" class="back-contanier left-nav-container" style="position: absolute;left:25px;top:156px;z-index: 99;">
        <div>
            <section>
                <div class="left-nav-title" id="btn_projectinfo">工程概况</div>
                <div class="left-nav-header" style="display: none;">
                    <div>
                        <label>位置：</label>
                        <span>金沙江下游河段</span>
                    </div>
                    <div>
                        <label>标准：</label>
                        <span>一等大(1)型工程</span>
                    </div>
                </div>
                <ul class="left-nav-body" id="projectInfoAll">
                    <li>
                        <b>43.03</b>
                        <div>总库容（亿m³）</div>
                    </li>
                    <li>
                        <b>43.03</b>
                        <div>工程静态总投资（万元）</div>
                    </li>
                    <li>
                        <b>43.03</b>
                        <div>移民补偿静态费用（万元）</div>
                    </li>
                    <li>
                        <b>43.03</b>
                        <div>搬迁安置人口（人）</div>
                    </li>
                    <li>
                        <b>834</b>
                        <div>生产安置人口（人）</div>
                    </li>
                    <li>
                        <b>825</b>
                        <div>征收土地面积（k㎡）</div>
                    </li>
                    <li>
                        <b>765</b>
                        <div>征拆房屋面积（k㎡）</div>
                    </li>

                    <li>
                        <b>1600</b>
                        <div>影响企事业单位（个）</div>
                    </li>
                    <li>
                        <b>624.43</b>
                        <div>等级公路（km)</div>
                    </li>
                    <li>
                        <b>624.43</b>
                        <div>电力线路（km)</div>
                    </li>
                    <li>
                        <b>624.43</b>
                        <div>通信线路（km)</div>
                    </li>
                    <ul style="width: 282px;height: 0px;left: -90px;top: 184px;border: 0.5px dashed rgba(0, 192, 255, 0.65);margin-bottom: 20px;" ></ul>
                    <ul><li style="width: 330px;height: 25px; margin: 0px;"><div style="float: left;height: 18px;width: 90px;margin: 5px;">工程总投资</div><b style="float: left;margin: 0px;">1785.99亿元</b></li></ul>
                    <ul><li style="width: 330px;height: 25px;margin: 0px;margin-bottom: 15px;"><div style="float: left;height: 18px;width: 200px;margin: 5px;">云南部分建设征地移民安置补偿</div><b style="float: left;margin: 0px;">273.35亿元</b></li></ul>
                </ul>

            </section>
        </div>
        <div class="angle angle-left-top"></div>
        <div class="angle angle-left-bottom"></div>
        <div class="angle angle-right-top"></div>
        <div class="angle angle-right-bottom"></div>
    </div>
    <div style="display: none; left: 0%;bottom: 0%;background: rgba(5, 38, 75, 0.6);border-radius: 4px;margin: 25px;width: 344px;height: 36px;position:absolute;text-align: left;">
        <span id="lat" style="float: left;width: 150px;color: #ffffff;font-size: 14px;margin: 8px;">经度:</span>  
        <span id="lng" style="float: left;width: 150px;color: #ffffff;font-size: 14px;margin: 8px">纬度：</span>
    </div>
 <!-- 右侧导航 开始 -->
 <div class="back-contanier right-nav-container nav"style="position: absolute;right:30px;top:156px;z-index: 99;;">
    <ul class="left ellipse">
    </ul>
    <ul class="right">
        <li class="active"><img src="./icons/arrangePoint.png"/>安置点</li>
        <!-- todo 更改图片 -->
        <li><img src="./icons/land.png"/>土地</li>
        <li><img src="./icons/land.png"/>村落</li>
        <li><img src="./icons/dam2.png"/>大坝</li>
        <li><img src="./icons/dam2.png"/>企业单位</li>
        <li><img src="./icons/facility.png"/>专项设施</li>
        <li><img src="./icons/town.png"/>集镇建设</li> 
    </ul>
    <div class="angle angle-left-top"></div>
    <div class="angle angle-left-bottom"></div>
    <div class="angle angle-right-top"></div>
    <div class="angle angle-right-bottom"></div>
</div>
<!-- 右侧导航 结束 -->
    <!-- 村落信息栏 开始 -->
    <div class="back-contanier town-container facility-modal-container" id="pop" style="position: absolute;left:32%;top:150px;display: none;z-index: 999;">
        <div class="title" >中路乡咱利村腊母底小组</div>
        <hr class="mock-border" />
        <div class="warpper" id="mapCont">
            <label class="high-light">土地编号：</label>
            <span>28530562</span>
        </div>
    </div>
    <!-- 村落信息栏 结束 -->

<script type="text/javascript">
        //初始化地图
        var _TiandituSLLabelPath = "http://t{s}.tianditu.gov.cn/cva_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cva&tileMatrixSet=c&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk=b7abd507700e4f349a8c0118ccab43ac";
        var _TiandituYXLabelPath = "http://t{s}.tianditu.gov.cn/cia_c/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=c&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=b7abd507700e4f349a8c0118ccab43ac";
        var _TiandituYXPath = "http://t{s}.tianditu.gov.cn/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk=b7abd507700e4f349a8c0118ccab43ac";
        var projects = null;
        var layer_poi = new L.LayerGroup();
        var flag = false;
        var initCenter = [25.070801, 101.623535];
        var path_qinyun = location.origin;
        var path,path_map="";
        map  = new L.map("mapDiv", {
            minZoom: 1,
            maxZoom: 18,
            center: initCenter,
            zoom: 6,
            zoomControl: true,
            attributionControl: false,
            crs:L.CRS.EPSG4326,
            editable: true,
            doubleClickZoom:false
        });
        $("#mapDiv").height($(window).height()　);
        var zoomstart = 0;
        var layer_dom =null;
        var layer_xzqh = null;
        var layer_cmxz = null;
        var popup = L.popup();
        $(document).ready(function () {
        layer_dom = new L.LayerGroup().addTo(map);
        layer_poi = new L.LayerGroup().addTo(map);
        layer_cmxz = new L.LayerGroup().addTo(map);
        // path = "http://192.168.10.230:6810";
        //  path_map = "http://192.168.10.230:7010";
        path = "http://117.26.22.125/gisapi";
        path_map = "http://117.26.22.125/gis";
        if(location.origin=="http://36.147.6.52:8088"){
        L.tileLayer(_TiandituYXPath, { subdomains: [1, 2, 3], minZoom: 5, maxZoom: 20, storagetype: 0 }).addTo(map);
        L.tileLayer(_TiandituYXLabelPath, { subdomains: [1, 2, 3], minZoom: 5, maxZoom: 20, storagetype: 0 }).addTo(map);
        }else{
        // layer_dom.addLayer(L.tileLayer(path_map+'/sj_raster/v6/wmts/tile/10000201?ak=mf72ff9295c740ec0f37e61433e8a3ad8d&service=WMTS&request=GetTile&version=1.0.0&layer=&style=&tilematrixSet=GoogleCRS84Quad&transparent=1&width=256&height=256&opacity=1&srs=EPSG:4326&tilematrix={z}&tilerow={y}&tilecol={x}', {
        //     attribution: '&copy; <a href="http://osm.org/copyright"></a> contributors'
        // }));
        // layer_dom.addLayer(L.tileLayer('http://192.168.10.231:7010/sj_raster/v6/wmts/tile/1002001?ak=mf72ff9295c740ec0f37e61433e8a3ad8d&service=WMTS&request=GetTile&version=1.0.0&layer=&style=&tilematrixSet=GoogleMapsCompatible&transparent=1&width=256&height=256&opacity=1&srs=EPSG:4490&tilematrix={z}&tilerow={y}&tilecol={x}', {
        //    attribution: '&copy; <a href="http://osm.org/copyright"></a> contributors'
        // }));
        layer_dom.addLayer(L.tileLayer('http://117.26.22.125/gisx/sj_raster/v6/wmts/tile/1002001?ak=mf72ff9295c740ec0f37e61433e8a3ad8d&service=WMTS&request=GetTile&version=1.0.0&layer=&style=&tilematrixSet=GoogleMapsCompatible&transparent=1&width=256&height=256&opacity=1&srs=EPSG:4490&tilematrix={z}&tilerow={y}&tilecol={x}', {
           attribution: '&copy; <a href="http://osm.org/copyright"></a> contributors'
        }));
        initXZQH();
        loadLTData(getUrlParam("projId"));
        }
        initProjectInfo(getUrlParam("projId"));
        //initProjectPOI(getUrlParam("projId"));
        $("#btn_projectinfo").click(function(){
            if($("#projectInfoAll").is(":hidden")){
                $("#projectInfoAll").show(500);    //如果元素为隐藏,则将它显现
            }else{
                $("#projectInfoAll").hide(500);     //如果元素为显现,则将其隐藏
            }
        });

      
        function onMapClick(e) {
           $("#pop").hide();
           $(".left").hide();
        }
        map.on('click', onMapClick);
     
        });
         function initProjectInfo(id){
            $.ajax({
        url: path_qinyun+"/wb/api/projectconfig/project/query_by_id?id="+id+"&secret=88d68fcf-2c2b-4510-ac38-ad5c6e97b22f",
        type: 'get',
         async: true,
         dataType: "json",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
            var jsonData=  res;
            if(jsonData.data.property.lbs!=undefined){
            var arr = jsonData.data.property.lbs.split(',')
            local = [arr[0],arr[1]];
            map.setView(local,13);
            }
            var str=""
            if(jsonData.data.industryTypeName=="水利"){
                str+="<li><b>"; str+=jsonData.data.property.zkr==undefined ? "暂无" : jsonData.data.property.zkr;str+="</b><div>总库容（亿m³）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.gcjtztz==undefined ? "暂无" : jsonData.data.property.gcjtztz;str+="</b><div>工程静态总投资（万元）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.ymztz==undefined ? "暂无" : jsonData.data.property.ymztz ;str+="</b><div>移民补偿静态费用（万元）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.bqazrs==undefined ? "暂无" : jsonData.data.property.bqazrs ;str+="</b><div>搬迁安置人口（人）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.scazrs==undefined ? "暂无" : jsonData.data.property.scazrs ;str+="</b><div>生产安置人口（人）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.zdzmj==undefined ? "暂无" : jsonData.data.property.zdzmj ;str+="</b><div>征收土地面积（亩）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.cqfwmj==undefined ? "暂无" : jsonData.data.property.cqfwmj ;str+="</b><div>征拆房屋面积（㎡）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.yxqsydw==undefined ? "暂无" : jsonData.data.property.yxqsydw ;str+="</b><div>影响企事业单位（个）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.djgl==undefined ? "暂无" : jsonData.data.property.djgl ;str+="</b><div>等级公路（km)</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.dlxl==undefined ? "暂无" : jsonData.data.property.dlxl ;str+="</b><div>电力线路（km)</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.txxl==undefined ? "暂无" : jsonData.data.property.txxl ;str+="</b><div>通信线路（km)</div></li>";
            initProjectPOI(getUrlParam("projId"),"水库");
            }else if(jsonData.data.industryTypeName=="水电")
           {
            str+="<li><b>"; str+=jsonData.data.property.zjrl==undefined ? "暂无" : jsonData.data.property.zjrl;str+="</b><div>装机容量（MW）</div></li>";
            str+="<li><b>"; str+=jsonData.data.property.pjnfl==undefined ? "暂无" : jsonData.data.property.pjnfl;str+="</b><div>年发电量（亿kWh）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.gcjtztz==undefined ? "暂无" : jsonData.data.property.gcjtztz;str+="</b><div>工程静态总投资（万元）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.ymztz==undefined ? "暂无" : jsonData.data.property.ymztz ;str+="</b><div>移民补偿静态费用（万元）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.bqazrs==undefined ? "暂无" : jsonData.data.property.bqazrs ;str+="</b><div>搬迁安置人口（人）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.scazrs==undefined ? "暂无" : jsonData.data.property.scazrs ;str+="</b><div>生产安置人口（人）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.zdzmj==undefined ? "暂无" : jsonData.data.property.zdzmj ;str+="</b><div>征收土地面积（亩）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.cqfwmj==undefined ? "暂无" : jsonData.data.property.cqfwmj ;str+="</b><div>征拆房屋面积（㎡）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.yxqsydw==undefined ? "暂无" : jsonData.data.property.yxqsydw ;str+="</b><div>影响企事业单位（个）</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.djgl==undefined ? "暂无" : jsonData.data.property.djgl ;str+="</b><div>等级公路（km)</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.dlxl==undefined ? "暂无" : jsonData.data.property.dlxl ;str+="</b><div>电力线路（km)</div></li>";
            　str+="<li><b>"; str+=jsonData.data.property.txxl==undefined ? "暂无" : jsonData.data.property.txxl ;str+="</b><div>通信线路（km)</div></li>";
            initProjectPOI(getUrlParam("projId"),"坝址");
           }
        $(".header-title").html(jsonData.data.name+"");
        $("#projectInfoAll").html(str);

        },
        error:function(err){
            console.log(err);
           }
         });
        }
        var local = [];
        var arr_POI = [];
        var data_type =[];
        var firstName = "";
         function initProjectPOI(id,Name){
            firstName = Name;
            $.ajax({
        url: path_qinyun+"/wb/api/projectconfig/satellite/list?projectId="+id,
        type: 'get',
        contentType: 'application/json',
          dataType: "json",
        success: function (res) {

             var arr_cunluo = [];
             var arr_anzhi = [];
             var arr_jizhen = [];
             var arr_zhuanxiang = [];
             jsonData =res.data;
            for(var i=0;i<jsonData.length;i++){
                  switch(jsonData[i].subType){
                      case"01":
                      arr_cunluo.push(i);
                      break;
                      case"02":
                      arr_anzhi.push(i);
                      break;
                      case"03":
                      arr_jizhen.push(i);
                      break;
                      case"04":
                      arr_anzhi.push(i);
                      break;
                      case"05":
                      arr_zhuanxiang.push(i);
                      break;
                      case"06":
                      arr_zhuanxiang.push(i);
                      break;
                      case"07":
                      arr_zhuanxiang.push(i);
                      break;
                  }
            }
if(firstName=="水库")data_type = {"水库":[],"村落":arr_cunluo,"安置点":arr_anzhi,"集镇":arr_jizhen,"专业项目":arr_zhuanxiang};
if(firstName=="坝址")data_type = {"坝址":[],"村落":arr_cunluo,"安置点":arr_anzhi,"集镇":arr_jizhen,"专业项目":arr_zhuanxiang};
            //设置关键点列表
        $(".right").html("");
        var flag_type=0;
        for(var type in data_type){//遍历json数组时，这么写p为索引，0,1
            $(".right").append('<li class="button_type" id="type'+type+'"><img  src="./icons/icon'+flag_type+'.png"/>'+type+'</li>');
            $(".ellipse").hide();
            flag_type++;
        }
        $(".button_type").click(function(){      
            var index =  $(this)[0].id.replace("type","");
            if(index=="水库"||index=="坝址"){map.setView(local,13);return;}
            $(".ellipse").show(500);
            $(".left").show();
            $(".left").html("");
            for (var i = 0; i < data_type[index].length; i++) {
            var info = jsonData[data_type[index][i]];
            if(info.HasCamera)
            $(".left").append('<li class="localButton" id="localButton'+info.id+'">'+info.name+'</li><img id="Camera'+info.id+'" src="img/Vector.png" class="camera"/>');
            else
            $(".left").append('<li class="localButton" id="localButton'+info.id+'">'+info.name+'</li>');
            // var startPosition = new Cesium.Cartesian3.fromDegrees(info.lng*1, info.lat*1, info.h*1);
            // if(i==0)    viewer.scene.scanEffect.centerPostion = startPosition;else
            // viewer.scene.scanEffect.add(startPosition);
            }
            $(".localButton").click(function(){
                var index_local =  $(this)[0].id.replace("localButton","")*1;
                for(var i=0;i<jsonData.length;i++){
                if(jsonData[i].id==index_local){
                    if(jsonData[i].name=="通信线路"||jsonData[i].name=="10kv以上电力线路"||jsonData[i].name=="等级公路"){
                        loadPOIInfo(i,1000,250);
                     }
                    
                var arr = jsonData[i].lbs.split(',');
               map.setView([arr[0], arr[1]], 17);
                }
                }
            });
            loadPOI(index);
        });
        },
        error:function(err){
            console.log(err);
           }
         });
}
//按类型加载poi
function loadPOI(flage_type) {
    layer_poi.clearLayers();
        if(flage_type==""){
            for(var type in data_type){//遍历json数组时，这么写p为索引，0,1
                loadPOIByType(type);
             }
        }else{
            loadPOIByType(flage_type);
        }
        flag_poi = true;
    }
    function loadPOIByType(type){
        if(type=="专业项目")return;
        for (var i = 0; i < data_type[type].length; i++) {
        var info = jsonData[data_type[type][i]];
        if(info.lbs==undefined) {alert("坐标信息获取失败");return;}
              var marker = L.marker( [info.lbs.split(',')[0], info.lbs.split(',')[1]], {
                                      icon: L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "icons/"+type+".png",}),
                                      attribution: data_type[type][i],
                                      highlight: 'temporary'
                                  }).addTo(layer_poi);
              marker.bindTooltip("<div>" +info.name + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
              marker.on("click", function (e) {//为marker绑定点击事件
                loadPOIInfo(e.target.options.attribution*1,e.originalEvent.clientX,e.originalEvent.clientY);
    });
}
    }
</script>
<script >
          //加载市界
        function initXZQH(){
                var  cont={
                "dataset_list": [
                    {
                        "dataset_id": 1070,
                        "field_list": [
                            "PAC",
                            "NAME",
                            "DISPNAME",
                            "FULLNAME",
                            "UPPAC",
                            "UPNAME",
                            "BZ",
                            "XH",
                            "X",
                            "Y",
                            "SHAPE_Length",
                            "SHAPE_Area"
                        ]
                    }
                ],
                "query_define": {
                    "page_count": 20,
                    "page_num": 1
                }
            };
          $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?access_token=mk.7be49279ea411a18dd6aface64ede5a2&op=select",
        type: 'post',
        data: JSON.stringify(cont),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
         var shijie=  eval ("(" + res + ")");
          console.log(shijie);
          layer_xzqh = L.featureGroup([]).addTo(map);
          for(var i=0;i<shijie.result[0].features.length;i++){
              showVector(shijie.result[0].features[i].geometry.coordinates, '#ffff00', '#ffff00', 4, 2,0);//云南县级区划
              }
        },
        error:function(err){
            console.log(err);
           }
         });
}
        //显示矢量数据
        function showVector( coordinates, color, fillcolor, width, opacity,fillOpacity) {
                        if(coordinates[0].length==1)
                        coordinates = coordinates[0];
                            var nwkt = "POLYGON((";
                            for(var i=0;i<coordinates[0].length;i++){
                                if(i==coordinates[0].length-1)
                                nwkt += coordinates[0][i][0] + " " + coordinates[0][i][1];
                                else
                                nwkt += coordinates[0][i][0] + " " + coordinates[0][i][1]+",";
                            }
                            nwkt += "))";
                            var fea = omnivore.wkt.parse(nwkt);
                                fea.setStyle({
                                    color: color,
                                    opacity: opacity,
                                    fillColor: fillcolor,
                                    fillOpacity: fillOpacity,
                                    width: width,
                                    weight: opacity
                                });
                                layer_xzqh.addLayer(fea);
                    }
        //设置拟建在建待建查询条件
                var flag_where =["all"];
                function   initSql(){
                $(".legend-item-icon").click(function(){
                    if( $(this).css("background-color")=='rgba(0, 0, 0, 0)')
                        $(this).css("background-color",'rgba(255, 255, 255, 0.9)');
                    else
                        $(this).css("background",'rgba(0, 0, 0, 0)');
                    initflag_where();
                    initProject(); 
                });
                }
                function initflag_where(){
                    flag_where =["all"];
                if( $("#btn_zaijian").css("background-color")!='rgba(0, 0, 0, 0)')
                flag_where.push(["!=","STACODE","在建"]);  
                if( $("#btn_nijian").css("background-color")!='rgba(0, 0, 0, 0)')
                flag_where.push(["!=","STACODE","待建"]);  
                if( $("#btn_yijian").css("background-color")!='rgba(0, 0, 0, 0)')
                flag_where.push(["!=","STACODE","已建"]);  
                return flag_where;
                }
                //获取地址传值     
                function getUrlParam(name) {
                    console.log(window.location.search.substr(1).match(reg))
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                    var r = window.location.search.substr(1).match(reg); //匹配目标参数
                    if (r != null) return unescape(r[2]); return null; //返回参数值 
                }
                        //点击图标弹窗
        function  loadPOIInfo(index,x,y){
          $("#pop").css("left",x).css("top",y);
                    var info=  jsonData[index];
                    var str = ' <div class="title" >'+info.name+'</div>';
                    switch(jsonData[index].subType){
                      case"01":
                   if(info.xzqh_name!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span>'+info.xzqh_name+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span></span> </div>';
                    if(info.ssqy_name!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">所属区域：</label>  <span>'+info.ssqy_name+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">所属区域：</label>  <span></span> </div>';
                    if(info.syxc_bqrk!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">搬迁人口：</label>  <span>'+info.syxc_bqrk+'（人）</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">搬迁人口：</label>  <span></span> </div>';
                    if(info.syxc_azqx!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">安置去向：</label>  <span>'+info.syxc_azqx+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">安置去向：</label>  <span></span> </div>';
                      break;
                      case"02":
                      if(info.xzqh_name!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span>'+info.xzqh_name+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span></span> </div>';
                    if(info.jmd_ydmj!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">用地面积：</label>  <span>'+info.jmd_ydmj+'(k㎡)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">用地面积：</label>  <span></span> </div>';
                    if(info.jmd_azrs!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">安置人数：</label>  <span>'+info.jmd_azrs+'（人）</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">安置人数：</label>  <span></span> </div>';
                    if(info.jmd_ymly!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">移民来源：</label>  <span>'+info.jmd_ymly+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">移民来源：</label>  <span></span> </div>';
                      break;
                      case"03":
                      if(info.xzqh_name!=undefined)
                      str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span>'+info.xzqh_name+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span></span> </div>';
                    if(info.syxjz_zdmj!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">占地面积：</label>  <span>'+info.syxjz_zdmj+'(㎡)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">占地面积：</label>  <span></span> </div>';
                    if(info.syxjz_bqrs!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">搬迁人数：</label>  <span>'+info.syxjz_bqrs+'（人）</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">搬迁人数：</label>  <span></span> </div>';
                    if(info.syxjz_yxdw!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">影响单位：</label>  <span>'+info.syxjz_yxdw+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">影响单位：</label>  <span></span> </div>';
                      break;
                      case"04":
                      if(info.xzqh_name!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span>'+info.xzqh_name+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">行政区划：</label>  <span></span> </div>';
                    if(info.jz_ydmj!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">用地面积：</label>  <span>'+info.jz_ydmj+'(k㎡)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">用地面积：</label>  <span></span> </div>';
                    if(info.jz_azrs!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">安置人数：</label>  <span>'+info.jz_azrs+'（人）</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">安置人数：</label>  <span></span> </div>';
                    if(info.jz_ymly!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">移民来源：</label>  <span>'+info.jz_ymly+'</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">移民来源：</label>  <span></span> </div>';
                      break;
                      case"05":
                      if(info.zyzx_yxcd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">影响长度：</label>  <span>'+info.zyzx_yxcd+'(km)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">影响长度：</label>  <span></span> </div>';
                    if(info.zyzx_ghcd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">规划长度：</label>  <span>'+info.zyzx_ghcd+'(km)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">规划长度：</label>  <span></span> </div>';
                    if(info.zyzx_jd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">综合建设进度：</label>  <span>'+info.zyzx_jd+'%</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">综合建设进度：</label>  <span></span> </div>';
                      break;
                      case"06":
                      if(info.zyzx_yxcd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">影响长度：</label>  <span>'+info.zyzx_yxcd+'(km)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">影响长度：</label>  <span></span> </div>';
                    if(info.zyzx_ghcd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">规划长度：</label>  <span>'+info.zyzx_ghcd+'(km)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">规划长度：</label>  <span></span> </div>';
                    if(info.zyzx_jd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">综合建设进度：</label>  <span>'+info.zyzx_jd+'%</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">综合建设进度：</label>  <span></span> </div>';
                      break;
                      case"07":
                      if(info.zyzx_yxcd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">影响长度：</label>  <span>'+info.zyzx_yxcd+'(km)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">影响长度：</label>  <span></span> </div>';
                    if(info.zyzx_ghcd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">规划长度：</label>  <span>'+info.zyzx_ghcd+'(km)</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">规划长度：</label>  <span></span> </div>';
                    if(info.zyzx_jd!=undefined)
                    str +='   <div class="warpper" >  <label class="high-light">综合建设进度：</label>  <span>'+info.zyzx_jd+'%</span> </div>';
                    else  str +='   <div class="warpper" >  <label class="high-light">综合建设进度：</label>  <span></span> </div>';
                      break;
                  }
                    $("#pop").html(str); 
                    $("#pop").show(500); 
                }
</script>
<script>
     var LTName = "";
     var arr_jiandou =[];
  function  loadLTData(id){
    for(var p in projectCast){
            if(projectCast[p]==id)LTName = p;
                           };
                           //加载大型项目图标
                           if(LTName=="")return;
          var  cont={
            "dataset_list": [
              {
                "dataset_id": 1092,//1074,
                "field_list": [
                  "VOLUME",
                  "FUND",
                  "SCALE",
                  "TYPE",
                  "LAT",
                  "LON",
                  "STACODE",
                  "NAME",
                  "PAC",
                  "ADNAME",
                  "SUMNAMBER",
                  "TYPE",
                  "DATA",
                  "UNCODE",
                  "STATUS",
                  "PRODATA"
                ],
                "filter": ["all",["==","NAME",LTName]]
              }
            ],
            "query_define": {
              "bbox": {
                "rect_maxx": 105.630030074,
                "rect_miny": 21.577357499,
                "rect_minx": 97.639511463,
                "rect_maxy": 28.612581131
              },
              "crs": {
                "crsid": "EPSG:4326"
              }
            }
          };
          $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont),
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',

        success: function (res) {
        var  projects=  eval ("(" + res + ")");
        map.setView([projects.result[0].features[0].properties.LAT,projects.result[0].features[0].properties.LON],10);
        layer_cmxz.clearLayers();
        for(var i=0;i<arr_jiandou.length;i++){
            arr_jiandou[i].hide();
        }
        arr_jiandou=[];
         var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1096,//1022,
                "field_list": ["GID", "BID", "NOTE", "STATUS", "BJ", "X", "Y"],
                "filter": ["all",["==","GID",projects.result[0].features[0].properties.UNCODE]]}],//5e014c91dc694efda55628a92be479a5"5e014c91dc694efda55628a92be479a5"]]}],//
            "query_define":  {"page_count": 100, "page_num": 1},
              "crs": {
                "crsid": "EPSG:4326"
              }
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
          var jsonData=  eval ("(" + res + ")");
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
           addcunzu(poi.properties.BID);
          }
        },
        error:function(err){
            console.log(err);
           }
         });

        },
        error:function(err){
            console.log(err);
           }
         });
        
  }
  function addcunzu(uccode){
         var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1093,//1024,
                "field_list": ["NAME", "PAC", "ADNAME", "SUMNAMBER", "NUMBER1", "TYPE", "DATA", "UNCODE", "COLLECTOR"],
                "filter": ["all",["==","UNCODE",uccode]]}],//5e014c91dc694efda55628a92be479a5
            "query_define": 
             {bbox: {rect_maxx: 105.630030074, rect_miny: 21.577357499, rect_minx: 97.639511463, rect_maxy: 28.612581131},
             crs: {crsid: "EPSG:4326"}}
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
          var jsonData=  eval ("(" + res + ")");
         
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
            var marker = L.marker([ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]], {
                                      icon: L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./icons/村落.png",}),
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_cmxz);
           //marker.bindTooltip("<div>" +poi.properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] });
           loadanzhi(poi.properties.UNCODE,[ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]]);
           //marker.on({'click': function (e) {loadanzhi(poi.properties.UNCODE,[ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]]);}}); 
           marker.on({
			            'mouseover': function (e) {
                    e.target.bindTooltip("<div>" +jsonData.result[0].features[e.target.options.attribution*1].properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
                    //e.target.openTooltip();
                },
			            'mouseout': function (e) {
                    e.target.closeTooltip();
			            }
			            }); 
                
          
          }

        },
        error:function(err){
            console.log(err);
           }
         });
        }
function loadanzhi(BID,startPOI){
          
    var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1097,//1023,
                "field_list": ["AID", "BID", "TYPE", "NUMBER1", "NOTE", "STATUS", "X", "Y"],
                "filter": ["all",["==","BID",BID]]}],//5e014c91dc694efda55628a92be479a5
            "query_define": 
             {bbox:  {"rect_miny": 59.944954, "rect_minx": 183.302752, "rect_maxy": 60.044954, "rect_maxx": 183.402752},
             crs: {crsid: "EPSG:4326"}}
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
    
          var jsonData=  eval ("(" + res + ")");
         
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
           addAnzhi(poi.properties.AID,startPOI);
          }
        },
        error:function(err){
            console.log(err);
           }
         });
        }
        var arr_jiandou = [];
  function addAnzhi(AID,startPOI){
    var  cont1={
            "dataset_list": [
              {
                "dataset_id": 1095,//1020,
                "field_list":["NAME", "ADDRESS", "PAC", "ADNAME", "SUMNAMBER", "NUMBER1", "FROM1", "NOTE", "PRODATA", "COLLECTOR"],
                "filter": ["all",["==", "UNCODE", AID]]}],//5e014c91dc694efda55628a92be479a5
            "query_define": 
             {bbox:  {rect_maxy: 28.601194255, rect_maxx: 105.630030074, rect_miny: 21.478486988, rect_minx: 97.683532077},
             crs: {crsid: "EPSG:4326"}}
            };
            $.ajax({
        url: path+"/sevector/v1/api/feature_query_ex?op=select&access_token=mk.7be49279ea411a18dd6aface64ede5a2",
        type: 'post',
        data: JSON.stringify(cont1),
        // cache: true,
         async: true,
         dataType: "text",
        'processData': false,
        'contentType': 'text/plain',
        success: function (res) {
          var jsonData=  eval ("(" + res + ")");
         
          for(var i=0;i< jsonData.result[0].features.length;i++){
           var poi= jsonData.result[0].features[i];
           poi.properties.AID
            var marker = L.marker([ poi.geometry.coordinates[1],  poi.geometry.coordinates[0]], {
                                      icon: L.icon({iconSize: [40, 40],iconAnchor: [20, 20],iconUrl: "./icons/安置点.png",}),
                                      attribution: i,
                                      highlight: 'temporary'
                                  }).addTo(layer_cmxz);
           //marker.bindTooltip("<div>" +poi.properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
           marker.on({
			            'mouseover': function (e) {
                    e.target.bindTooltip("<div>" +jsonData.result[0].features[e.target.options.attribution*1].properties.NAME + "</div>", { permanent: true, direction: 'left', offset: [-20, 0] }).openTooltip();
                    //e.target.openTooltip();
                },
			            'mouseout': function (e) {
                    e.target.closeTooltip();
			            }
			            }); 

           var data = [{"from":[startPOI[1],startPOI[0]],"to":[ poi.geometry.coordinates[0],  poi.geometry.coordinates[1]],"labels":["",""],"color":"#ff3a31"}];
 
            var migrationLayer = new L.migrationLayer({
                map: map,
                data: data,
                pulseRadius:30,
                pulseBorderWidth:3,
                arcWidth:1,
                arcLabel:true,
                arcLabelFont:'10px sans-serif',
                }
            );
            migrationLayer.addTo(map); 
            arr_jiandou.push(migrationLayer);

          }
        },
        error:function(err){
            console.log(err);
           }
         });

  }
</script>
<script >(function (window) {
    var utils = {
        // color:rgb或rgba格式
        // opacity: 透明度
        calculateColor: function (color, opacity) {
            if (color.indexOf('#') === 0) {
                var color16 = color.slice(1);
                var r = parseInt(color16.slice(0, 2), 16);
                var g = parseInt(color16.slice(2, 4), 16);
                var b = parseInt(color16.slice(4), 16);
                return 'rgba(' + r + ',' + g + ',' + b + ',' + opacity + ')';
            } else if (/^rgb\(/.test(color)) {
                return color.replace(/rgb/, 'rgba').replace(')', ",") +
                    opacity + ')';
            } else {
                return color.split(',').splice(0, 3).join(',') +
                    opacity + ')';
            }
        }
    };
    var arrayUtils = {
        forEach: function (arr, cb, scope) {
            if (typeof Array.prototype.forEach === 'function') {
                arr.forEach(cb, scope);
            } else {
                for (var i = 0, len = arr.length; i < len; i++) {
                    cb.apply(scope, [arr[i], i, arr]);
                }
            }
        },
        map: function (arr, cb, scope) {
            if (typeof Array.prototype.map === 'function') {
                return arr.map(cb, scope);
            } else {
                var mapped = [];
                for (var i = 0, len = arr.length; i < len; i++) {
                    mapped[i] = cb.apply(scope, [arr[i], i, arr]);
                }
                return mapped;
            }
        }
    };
 
    var Marker = (function () {
        var M = function (options) {
            this.x = options.x;
            this.y = options.y;
            this.rotation = options.rotation;
            this.style = options.style;
            this.color = options.color;
            this.size = options.size;
            this.borderWidth = options.borderWidth;
            this.borderColor = options.borderColor;
        };
 
        M.prototype.draw = function (context) {
            context.save();
            context.translate(this.x, this.y);
            context.rotate(this.rotation);
 
            context.lineWidth = this.borderWidth || 0;
            context.strokeStyle = this.borderColor || '#000';
            context.fillStyle = this.color || '#000';
            // 目前先只支持圆
            context.beginPath();
            if (this.style === 'circle') {
                context.arc(0, 0, this.size, 0, Math.PI * 2, false);
            } else if (this.style === 'arrow') {
                context.moveTo(-this.size, -this.size);
                context.lineTo(this.size, 0);
                context.lineTo(-this.size, this.size);
                context.lineTo(-this.size / 4, 0);
                context.lineTo(-this.size, -this.size);
            }
            context.closePath();
            context.stroke();
            context.fill();
            context.restore();
        };
 
        return M;
    })();
 
    var Arc = (function () {
        var A = function (options) {
            var startX = options.startX,
                startY = options.startY,
                endX = options.endX,
                endY = options.endY;
            //两点之间的圆有多个，通过两点及半径便可以定出两个圆，根据需要选取其中一个圆
            var L = Math.sqrt(Math.pow(startX - endX, 2) + Math.pow(startY - endY, 2));
            var m = (startX + endX) / 2; // 横轴中点
            var n = (startY + endY) / 2; // 纵轴中点
            var factor = 1.5;
 
            var centerX = (startY - endY) * factor + m;
            var centerY = (endX - startX) * factor + n;
 
            var radius = Math.sqrt(Math.pow(L / 2, 2) + Math.pow(L * factor, 2));
            var startAngle = Math.atan2(startY - centerY, startX - centerX);
            var endAngle = Math.atan2(endY - centerY, endX - centerX);
 
            // this.L = L;
            this.startX = startX;
            this.startY = startY;
            this.endX = endX;
            this.endY = endY;
            this.centerX = centerX;
            this.centerY = centerY;
            this.startAngle = startAngle;
            this.endAngle = endAngle;
            this.startLabel = options && options.labels && options.labels[0],
                this.endLabel = options && options.labels && options.labels[1],
                this.radius = radius;
            this.lineWidth = options.width || 1;
            this.strokeStyle = options.color || '#000';
            this.label = options.label;
            this.font = options.font;
            this.shadowBlur = options.shadowBlur;
        };
 
        A.prototype.draw = function (context) {
            context.save();
            context.lineWidth = this.lineWidth;
            context.strokeStyle = this.strokeStyle;
            context.shadowColor = this.strokeStyle;
            context.shadowBlur = this.shadowBlur || 2;
 
            context.beginPath();
            context.arc(this.centerX, this.centerY, this.radius, this.startAngle, this.endAngle, false);
            context.stroke();
            context.restore();
 
            context.save();
            context.fillStyle = this.strokeStyle;
            if (this.label) {
                context.font = this.font;
                if (this.startLabel) {
                    var x = this.startX - 15
                    var y = this.startY + 5
                    context.fillText(this.startLabel, x, y);
                }
                if (this.endLabel) {
                    var x = this.endX - 15;
                    var y = this.endY - 5;
                    context.fillText(this.endLabel, x, y);
                }
            }
            context.restore();
        };
 
        return A;
    })();
 
    var Pulse = (function () {
        function P(options) {
            this.x = options.x;
            this.y = options.y;
            this.maxRadius = options.radius;
            this.color = options.color;
            this.shadowBlur = 5;
            this.lineWidth = options.borderWidth;
            this.r = 0;
            this.factor = 2 / options.radius;
        };
 
        P.prototype.draw = function (context) {
            // var vr = (this.maxRadius - this.r) * this.factor;
            var vr = 0.5;
            this.r += vr;
            // this.shadowBlur = Math.floor(this.r);
 
            context.save();
            context.translate(this.x, this.y);
            var strokeColor = this.color;
            strokeColor = utils.calculateColor(strokeColor, 1 - this.r / this.maxRadius);
            context.strokeStyle = strokeColor;
            context.shadowBlur = this.shadowBlur;
            context.shadowColor = strokeColor;
            context.lineWidth = this.lineWidth;
            context.beginPath();
            context.arc(0, 0, this.r, 0, Math.PI * 2, false);
            context.stroke();
            context.restore();
 
            if (Math.abs(this.maxRadius - this.r) < 0.8) {
                this.r = 0;
            }
        }
 
        return P;
    })();
 
    var Spark = (function () {
        var S = function (options) {
            var startX = options.startX,
                startY = options.startY,
                endX = options.endX,
                endY = options.endY;
 
            //两点之间的圆有多个，通过两点及半径便可以定出两个圆，根据需要选取其中一个圆
            var L = Math.sqrt(Math.pow(startX - endX, 2) + Math.pow(startY - endY, 2));
            var m = (startX + endX) / 2; // 横轴中点
            var n = (startY + endY) / 2; // 纵轴中点
            var factor = 1.5;
 
            var centerX = (startY - endY) * factor + m;
            var centerY = (endX - startX) * factor + n;
 
            var radius = Math.sqrt(Math.pow(L / 2, 2) + Math.pow(L * factor, 2));
            var startAngle = Math.atan2(startY - centerY, startX - centerX);
            var endAngle = Math.atan2(endY - centerY, endX - centerX);
 
            // 保证Spark的弧度不超过Math.PI
            if (startAngle * endAngle < 0) {
                if (startAngle < 0) {
                    startAngle += Math.PI * 2;
                    endAngle += Math.PI * 2;
                } else {
                    endAngle += Math.PI * 2;
                }
            }
 
            this.tailPointsCount = 50; // 拖尾点数
            this.centerX = centerX;
            this.centerY = centerY;
            this.startAngle = startAngle;
            this.endAngle = endAngle;
            this.radius = radius;
            this.lineWidth = options.width || 1;
            this.strokeStyle = options.color || '#fff';
            this.factor = 2 / this.radius;
            this.deltaAngle = (80 / Math.min(this.radius, 400)) / this.tailPointsCount;
            this.trailAngle = this.startAngle;
            this.arcAngle = this.startAngle;
 
            this.animateBlur = true;
 
            this.marker = new Marker({
                x: 50,
                y: 80,
                rotation: 50 * Math.PI / 180,
                style: 'arrow',
                color: 'rgb(255, 255, 255)',
                size: 3,
                borderWidth: 0,
                borderColor: this.strokeStyle
            });
        };
 
        S.prototype.drawArc = function (context, strokeColor, lineWidth, startAngle, endAngle) {
            context.save();
            context.lineWidth = lineWidth;
            // context.lineWidth = 5;
            context.strokeStyle = strokeColor;
            context.shadowColor = this.strokeStyle;
            // context.shadowBlur = 5;
            context.lineCap = "round";
            context.beginPath();
            context.arc(this.centerX, this.centerY, this.radius, startAngle, endAngle, false);
            context.stroke();
            context.restore();
        };
 
        S.prototype.draw = function (context) {
            var endAngle = this.endAngle;
            // 匀速
            var angle = this.trailAngle + this.factor;
            var strokeColor = this.strokeStyle;
            if (this.animateBlur) {
                this.arcAngle = angle;
            }
            this.trailAngle = angle;
            strokeColor = utils.calculateColor(strokeColor, 0.1);
 
            this.drawArc(context, strokeColor, this.lineWidth, this.startAngle, this.arcAngle);
 
            // 拖尾效果
            var count = this.tailPointsCount;
            for (var i = 0; i < count; i++) {
                var arcColor = utils.calculateColor(this.strokeStyle, 0.3 - 0.3 / count * i);
                var tailLineWidth = 5;
                if (this.trailAngle - this.deltaAngle * i > this.startAngle) {
                    this.drawArc(context, arcColor,
                        tailLineWidth - tailLineWidth / count * i,
                        this.trailAngle - this.deltaAngle * i,
                        this.trailAngle
                    );
                }
            }
 
            context.save();
            context.translate(this.centerX, this.centerY);
            this.marker.x = Math.cos(this.trailAngle) * this.radius;
            this.marker.y = Math.sin(this.trailAngle) * this.radius;
            this.marker.rotation = this.trailAngle + Math.PI / 2;
            this.marker.draw(context);
            context.restore();
 
            if ((endAngle - this.trailAngle) * 180 / Math.PI < 0.5) {
                this.trailAngle = this.startAngle;
                this.animateBlur = false;
            }
        };
 
        return S;
    })();
 
 
    var Migration = (function () {
        var M = function (options) {
            this.data = options.data;
            this.store = {
                arcs: [],
                markers: [],
                pulses: [],
                sparks: []
            };
            this.playAnimation = true;
            this.started = false;
            this.context = options.context;
            this.style = options.style;
            this.init();
        };
 
        M.prototype.init = function () {
            this.updateData(this.data);
        };
        /*
         * Shape 必须拥有draw方法
        */
        M.prototype.add = function (Shape) {
 
        };
        M.prototype.remove = function () {
 
        };
        M.prototype.clear = function () {
            this.store = {
                arcs: [],
                markers: [],
                pulses: [],
                sparks: []
            };
            // 更新状态
            this.playAnimation = true;
            this.started = false;
            // 清除绘画实例，如果没有这个方法，多次调用start，相当于存在多个动画队列同时进行
            window.cancelAnimationFrame(this.requestAnimationId);
        };
        /*
         * 更新数据
        */
        M.prototype.updateData = function (data) {
            if (!data || data.length === 0) {
                return;
            }
            this.clear();
            this.data = data;
            if (this.data && this.data.length > 0) {
                arrayUtils.forEach(this.data, function (element) {
                    var arc = new Arc({
                        startX: element.from[0],
                        startY: element.from[1],
                        endX: element.to[0],
                        endY: element.to[1],
                        labels: element.labels,
                        label: this.style.arc.label,
                        font: this.style.arc.font,
                        width: this.style.arc.width,
                        color: element.color
                    });
                    var marker = new Marker({
                        x: element.to[0],
                        y: element.to[1],
                        rotation: arc.endAngle + Math.PI / 2,
                        style: 'arrow',
                        color: element.color,
                        size: 4,
                        borderWidth: 0,
                        borderColor: element.color
                    });
                    var pulse = new Pulse({
                        x: element.to[0],
                        y: element.to[1],
                        radius: this.style.pulse.radius,
                        color: element.color,
                        borderWidth: this.style.pulse.borderWidth
                    });
                    var spark = new Spark({
                        startX: element.from[0],
                        startY: element.from[1],
                        endX: element.to[0],
                        endY: element.to[1],
                        width: 15,
                        color: element.color
                    });
 
                    this.store.arcs.push(arc);
                    this.store.markers.push(marker);
                    this.store.pulses.push(pulse);
                    this.store.sparks.push(spark);
                }, this);
            }
        };
        /*
        */
        M.prototype.start = function (canvas) {
            var that = this;
            if (!this.started) {
                (function drawFrame() {
                    that.requestAnimationId = window.requestAnimationFrame(drawFrame, canvas);
 
                    if (that.playAnimation) {
                        canvas.width += 1;
                        canvas.width -= 1;
                        for (var p in that.store) {
                            var shapes = that.store[p];
                            for (var i = 0, len = shapes.length; i < len; i++) {
                                shapes[i].draw(that.context);
                            }
                        }
                    }
                })();
                this.started = true;
            }
        };
        M.prototype.play = function () {
            this.playAnimation = true;
        };
        M.prototype.pause = function () {
            this.playAnimation = false;
        };
        return M;
    })();
 
    L.MigrationLayer = L.Class.extend({
        options: {
            map: {},
            data: {},
            pulseRadius: 25,
            pulseBorderWidth: 3,
            arcWidth: 1,
            arcLabel: true,
            arcLabelFont: '15px sans-serif',
            Marker: {},
            Spark: {}
 
        },
        _setOptions: function (obj, options) {
            if (!obj.hasOwnProperty('options')) {
                obj.options = obj.options ? L.Util.create(obj.options) : {};
            }
            for (var i in options) {
                obj.options[i] = options[i];
            }
            return obj.options;
        },
        initialize: function (options) {
            this._setOptions(this, options);
            this._map = this.options.map || {};
            this._data = this.options.data || {};
            this._style = {
                pulse: {
                    radius: this.options.pulseRadius,
                    borderWidth: this.options.pulseBorderWidth
                },
                arc: {
                    width: this.options.arcWidth,
                    label: this.options.arcLabel,
                    font: this.options.arcLabelFont
                }
            } || {};
            this._show = true;
            this._init();
        },
        _init: function () {
            var container = L.DomUtil.create('div', 'leaflet-ODLayer-container');
            container.style.position = 'absolute';
            container.style.width = this._map.getSize().x + "px";
            container.style.height = this._map.getSize().y + "px";
 
            this.container = container;
 
            this.canvas = document.createElement('canvas');
            this.context = this.canvas.getContext('2d');
            container.appendChild(this.canvas);
            this._map.getPanes().overlayPane.appendChild(container);
            //this._resize();
            if (!this.migration) {
                var data = this._convertData();
                this.migration = new Migration({
                    data: data,
                    context: this.context,
                    style: this._style
                });
                //this._draw();
                //this._bindMapEvents();
            }
        },
        _resize: function () {
            var bounds = this._map.getBounds();
            var topleft = bounds.getNorthWest();
            var topLeftscreen = this._map.latLngToContainerPoint(topleft);
            //当地图缩放或者平移到整个地图的范围小于外层容器的范围的时候，要对this.container进行上下平移操作，反之则回归原位
            if (topLeftscreen.y > 0) {
                this.container.style.top = -topLeftscreen.y + 'px';
            } else {
                this.container.style.top = '0px';
            }
 
            var containerStyle = window.getComputedStyle(this._map.getContainer());
            this.canvas.setAttribute('width', parseInt(containerStyle.width, 10));
            this.canvas.setAttribute('height', parseInt(containerStyle.height, 10));
        },
        _convertData: function () {
            var bounds = this._map.getBounds();
 
            if (this._data && bounds) {
                var data = arrayUtils.map(this._data, function (d) {
 
                    var fromPixel = this._map.latLngToContainerPoint(new L.LatLng(d.from[1], d.from[0]));
                    var toPixel = this._map.latLngToContainerPoint(new L.LatLng(d.to[1], d.to[0]));
                    return {
                        from: [fromPixel.x, fromPixel.y],
                        to: [toPixel.x, toPixel.y],
                        labels: d.labels,
                        value: d.value,
                        color: d.color
                    }
                }, this);
 
                return data;
            }
        },
        _bindMapEvents: function () {
            var that = this;
            // window.onresize = function () {
            //     that._resize();
            // };
            // this._map.on('movestart ', function () {
            //     that.migration.pause();
            // });
            this._map.on('moveend', function () {
                that.migration.play();
                that._draw();
            });
            this._map.on('zoomstart ', function () { that.container.style.display = 'none' });
            this._map.on('zoomend', function () {
                if (that._show) {
                    that.container.style.display = ''
                    that._draw();
                }
            });
        },
        _draw: function () {
            var bounds = this._map.getBounds();
            if (bounds && this.migration.playAnimation) {
                this._resize();
                this._transform();
                var data = this._convertData();
                this.migration.updateData(data);
                this.migration.start(this.canvas);
            }
        },
        _transform: function () {
            var bounds = this._map.getBounds();
            var topLeft = this._map.latLngToLayerPoint(bounds.getNorthWest());
            L.DomUtil.setPosition(this.container, topLeft);
        },
        addTo: function () {
            this._bindMapEvents();
            var bounds = this._map.getBounds();
            if (bounds && this.migration.playAnimation) {
                this._resize();
                this._transform();
 
                var data = this._convertData();
                this.migration.updateData(data);
                this.migration.start(this.canvas);
            }
        },
        setData: function (data) {
            this._data = data;
            this._draw();
        },
        hide: function () {
            this.container.style.display = 'none';
            this._show = false;
        },
        show: function () {
            this.container.style.display = '';
            this._show = true;
        },
        play: function () {
            this.migration.play();
        },
        pause: function () {
            this.migration.pause();
        },
        destroy: function () {
            this.migration.clear();
            //移除dom
            this.container.parentNode.removeChild(this.container);
            //移除事件监听
            this._map.clearAllEventListeners();
            this.mapHandles = [];
        }
 
    });
    L.migrationLayer = function (options) {
        return new L.MigrationLayer(options)
    }
})(window)
 </script>
  <script src="Config_project.js"></script>
</body>
</html>
